<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>/home/opennao/work/master/sdk/libqi/qi/type/detail/object.hxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>


<div id="top"><!-- do not remove this div! -->
<div class="related">
  <ul>
    <!-- <li style="margin-right: 10px" class="right"> -->
    <!--   <a accesskey="I" title="General Index" href="genindex.html">index</a> -->
    <!-- </li> -->
    <!-- <li class="right"> -->
    <!--   <a accesskey="N" title="Whatâ€™s new?" href="news/whatsnew/index.html">next</a> | -->
    <!-- </li> -->
    <li><a href="../../index.html">Aldebaran documentation</a> |</li>
    <li><a href="../../ref/cpp-api.html">C++ Libraries</a> |</li>
    <li><a href="index.html">index</a></li>
  </ul>
</div>


<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">libqi-api
   &#160;<span id="projectnumber">2.2.0.55</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/opennao/work/master/sdk/libqi/qi/type/detail/object.hxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a00415.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#pragma once</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment">**  Copyright (C) 2013 Aldebaran Robotics</span>
<a name="l00004"></a>00004 <span class="comment">**  See COPYING for the license</span>
<a name="l00005"></a>00005 <span class="comment">*/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#ifndef _QI_TYPE_DETAIL_OBJECT_HXX_</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#define _QI_TYPE_DETAIL_OBJECT_HXX_</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;boost/mpl/if.hpp&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="code" href="a00360.html">qi/future.hpp</a>&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="code" href="a00429.html">qi/type/typeinterface.hpp</a>&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="code" href="a00441.html">qi/type/typeobject.hpp</a>&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="code" href="a00427.html">qi/type/detail/typeimpl.hxx</a>&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;<a class="code" href="a00436.html">qi/type/metasignal.hpp</a>&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;<a class="code" href="a00433.html">qi/type/metamethod.hpp</a>&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;<a class="code" href="a00434.html">qi/type/metaobject.hpp</a>&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">// Visual defines interface...</span>
<a name="l00021"></a>00021 <span class="preprocessor">#ifdef interface</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#undef interface</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="keyword">namespace </span>qi {
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="a00196.html">00027</a> <span class="keyword">class </span><a class="code" href="a00196.html">Empty</a> {};
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">namespace </span>detail {
<a name="l00030"></a>00030 
<a name="l00031"></a>00031   <span class="comment">/* On ubuntu (and maybe other platforms), the linking is done by default with</span>
<a name="l00032"></a>00032 <span class="comment">   * --as-needed.</span>
<a name="l00033"></a>00033 <span class="comment">   * Proxy libraries constist only of static initialization functions which add</span>
<a name="l00034"></a>00034 <span class="comment">   * the proxy factories to the global maps, thus there is no direct dependency</span>
<a name="l00035"></a>00035 <span class="comment">   * between the program and the library (no function call whatsoever) and the</span>
<a name="l00036"></a>00036 <span class="comment">   * dependency gets dropped by the linker.</span>
<a name="l00037"></a>00037 <span class="comment">   * This class is specialized when including interfaces which have proxies</span>
<a name="l00038"></a>00038 <span class="comment">   * and the function is defined in the .so to force a dependency.</span>
<a name="l00039"></a>00039 <span class="comment">   */</span>
<a name="l00040"></a>00040   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00041"></a><a class="code" href="a00094.html">00041</a>   <span class="keyword">struct </span><a class="code" href="a00094.html">ForceProxyInclusion</a>
<a name="l00042"></a>00042   {
<a name="l00043"></a><a class="code" href="a00094.html#a4bb5447158c867ca88075db41e3efd00">00043</a>     <span class="keywordtype">bool</span> <a class="code" href="a00094.html#a4bb5447158c867ca88075db41e3efd00">dummyCall</a>() { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l00044"></a>00044   };
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="comment">// bounce to a genericobject obtained by (O*)this-&gt;asAnyObject()</span>
<a name="l00047"></a>00047   <span class="comment">/* Everything need to be const:</span>
<a name="l00048"></a>00048 <span class="comment">   * anyobj.call bounces to anyobj.asObject().call, and the</span>
<a name="l00049"></a>00049 <span class="comment">   * second would work on const object</span>
<a name="l00050"></a>00050 <span class="comment">   */</span>
<a name="l00051"></a><a class="code" href="a00011.html">00051</a>   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> O&gt; <span class="keyword">class </span><a class="code" href="a00011.html">GenericObjectBounce</a>
<a name="l00052"></a>00052   {
<a name="l00053"></a>00053   <span class="keyword">public</span>:
<a name="l00054"></a><a class="code" href="a00011.html#a1a1659bab801fae15a181e755a740adc">00054</a>     <span class="keyword">const</span> <a class="code" href="a00236.html" title="Description of the signals and methods accessible on an ObjectTypeInterface.">MetaObject</a> &amp;<a class="code" href="a00011.html#a1a1659bab801fae15a181e755a740adc">metaObject</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#a5afa72fca7181629ea3b52d7dc309f0d">metaObject</a>(); }
<a name="l00055"></a><a class="code" href="a00011.html#a13553a7f589b7d670010b1b94e69520f">00055</a>     <span class="keyword">inline</span> <a class="code" href="a00010.html">qi::Future&lt;AnyReference&gt;</a> <a class="code" href="a00011.html#a13553a7f589b7d670010b1b94e69520f">metaCall</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> method, <span class="keyword">const</span> <a class="code" href="a00215.html">GenericFunctionParameters</a>&amp; params, <a class="code" href="a00359.html#af26fc7fa51e2905573cda6a194af6cae">MetaCallType</a> callType = <a class="code" href="a00359.html#af26fc7fa51e2905573cda6a194af6caea0427d0d572be1d1929de10cb006946e8" title="Honor the default behavior.">MetaCallType_Auto</a>, <a class="code" href="a00270.html">Signature</a> returnSignature=<a class="code" href="a00270.html">Signature</a>())<span class="keyword"> const</span>
<a name="l00056"></a>00056 <span class="keyword">    </span>{
<a name="l00057"></a>00057       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#ad2d18085822c3f8d90958c8362a47a2a">metaCall</a>(method, params, callType, returnSignature);
<a name="l00058"></a>00058     }
<a name="l00059"></a><a class="code" href="a00011.html#afe1bbb317a1b1ec8ec12fd76d54c4c2d">00059</a>     <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="a00011.html#afe1bbb317a1b1ec8ec12fd76d54c4c2d">findMethod</a>(<span class="keyword">const</span> std::string&amp; name, <span class="keyword">const</span> <a class="code" href="a00215.html">GenericFunctionParameters</a>&amp; parameters)<span class="keyword"> const</span>
<a name="l00060"></a>00060 <span class="keyword">    </span>{
<a name="l00061"></a>00061       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#ad9b9c0ce8a31a854d0f5066c7038a840">findMethod</a>(name, parameters);
<a name="l00062"></a>00062     }
<a name="l00063"></a><a class="code" href="a00011.html#a624e9021cd8b5a12cecfa235ec5e36ae">00063</a>     <span class="keyword">inline</span> <a class="code" href="a00010.html">qi::Future&lt;AnyReference&gt;</a> <a class="code" href="a00011.html#a13553a7f589b7d670010b1b94e69520f">metaCall</a>(<span class="keyword">const</span> std::string &amp;nameWithOptionalSignature, <span class="keyword">const</span> <a class="code" href="a00215.html">GenericFunctionParameters</a>&amp; params, <a class="code" href="a00359.html#af26fc7fa51e2905573cda6a194af6cae">MetaCallType</a> callType = <a class="code" href="a00359.html#af26fc7fa51e2905573cda6a194af6caea0427d0d572be1d1929de10cb006946e8" title="Honor the default behavior.">MetaCallType_Auto</a>, <a class="code" href="a00270.html">Signature</a> returnSignature=<a class="code" href="a00270.html">Signature</a>())<span class="keyword"> const</span>
<a name="l00064"></a>00064 <span class="keyword">    </span>{
<a name="l00065"></a>00065       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#ad2d18085822c3f8d90958c8362a47a2a">metaCall</a>(nameWithOptionalSignature, params, callType, returnSignature);
<a name="l00066"></a>00066     }
<a name="l00067"></a><a class="code" href="a00011.html#acfe393a9c23b1eec3a5f3293a2749ca2">00067</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00011.html#acfe393a9c23b1eec3a5f3293a2749ca2">metaPost</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event, <span class="keyword">const</span> <a class="code" href="a00215.html">GenericFunctionParameters</a>&amp; params)<span class="keyword"> const</span>
<a name="l00068"></a>00068 <span class="keyword">    </span>{
<a name="l00069"></a>00069       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#a8cd969e87c1ff88d0f18deca337c7a79">metaPost</a>(event, params);
<a name="l00070"></a>00070     }
<a name="l00071"></a><a class="code" href="a00011.html#a20939ea0bf2b086f9a433baadc00c559">00071</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00011.html#acfe393a9c23b1eec3a5f3293a2749ca2">metaPost</a>(<span class="keyword">const</span> std::string &amp;nameWithOptionalSignature, <span class="keyword">const</span> <a class="code" href="a00215.html">GenericFunctionParameters</a> &amp;in)<span class="keyword"> const</span>
<a name="l00072"></a>00072 <span class="keyword">    </span>{
<a name="l00073"></a>00073       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#a8cd969e87c1ff88d0f18deca337c7a79">metaPost</a>(nameWithOptionalSignature, in);
<a name="l00074"></a>00074     }
<a name="l00075"></a><a class="code" href="a00011.html#a094d9c129bebc09e10145c373f6aa275">00075</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00011.html#a094d9c129bebc09e10145c373f6aa275">post</a>(<span class="keyword">const</span> std::string&amp; eventName,
<a name="l00076"></a>00076       <a class="code" href="a00028.html">qi::AutoAnyReference</a> p1 = <a class="code" href="a00028.html">qi::AutoAnyReference</a>(),
<a name="l00077"></a>00077       <a class="code" href="a00028.html">qi::AutoAnyReference</a> p2 = <a class="code" href="a00028.html">qi::AutoAnyReference</a>(),
<a name="l00078"></a>00078       <a class="code" href="a00028.html">qi::AutoAnyReference</a> p3 = <a class="code" href="a00028.html">qi::AutoAnyReference</a>(),
<a name="l00079"></a>00079       <a class="code" href="a00028.html">qi::AutoAnyReference</a> p4 = <a class="code" href="a00028.html">qi::AutoAnyReference</a>(),
<a name="l00080"></a>00080       <a class="code" href="a00028.html">qi::AutoAnyReference</a> p5 = <a class="code" href="a00028.html">qi::AutoAnyReference</a>(),
<a name="l00081"></a>00081       <a class="code" href="a00028.html">qi::AutoAnyReference</a> p6 = <a class="code" href="a00028.html">qi::AutoAnyReference</a>(),
<a name="l00082"></a>00082       <a class="code" href="a00028.html">qi::AutoAnyReference</a> p7 = <a class="code" href="a00028.html">qi::AutoAnyReference</a>(),
<a name="l00083"></a>00083       <a class="code" href="a00028.html">qi::AutoAnyReference</a> p8 = <a class="code" href="a00028.html">qi::AutoAnyReference</a>())<span class="keyword"> const</span>
<a name="l00084"></a>00084 <span class="keyword">    </span>{
<a name="l00085"></a>00085       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#ae152674e59b5e9e0a50a4a7afaacb570">post</a>(eventName, p1, p2, p3, p4, p5, p6, p7, p8);
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> FUNCTOR_TYPE&gt;
<a name="l00088"></a><a class="code" href="a00011.html#a499c0547921ae951bef0d2b30e1a92ad">00088</a>     <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;SignalLink&gt;</a> <a class="code" href="a00011.html#a499c0547921ae951bef0d2b30e1a92ad">connect</a>(<span class="keyword">const</span> std::string&amp; eventName, FUNCTOR_TYPE callback,
<a name="l00089"></a>00089       <a class="code" href="a00359.html#af26fc7fa51e2905573cda6a194af6cae">MetaCallType</a> threadingModel = <a class="code" href="a00359.html#af26fc7fa51e2905573cda6a194af6caea0427d0d572be1d1929de10cb006946e8" title="Honor the default behavior.">MetaCallType_Auto</a>)<span class="keyword"> const</span>
<a name="l00090"></a>00090 <span class="keyword">    </span>{
<a name="l00091"></a>00091       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#aab26dbf8a362a922c3d1ae2ff4ede0ef">connect</a>(eventName, callback, threadingModel);
<a name="l00092"></a>00092     }
<a name="l00093"></a><a class="code" href="a00011.html#a0bd095e5918b1f4587a66f08ba271be0">00093</a>     <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;SignalLink&gt;</a> <a class="code" href="a00011.html#a499c0547921ae951bef0d2b30e1a92ad">connect</a>(<span class="keyword">const</span> std::string &amp;name, <span class="keyword">const</span> <a class="code" href="a00269.html">SignalSubscriber</a>&amp; functor)<span class="keyword"> const</span>
<a name="l00094"></a>00094 <span class="keyword">    </span>{
<a name="l00095"></a>00095       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#aab26dbf8a362a922c3d1ae2ff4ede0ef">connect</a>(name, functor);
<a name="l00096"></a>00096     }
<a name="l00097"></a><a class="code" href="a00011.html#a200b52833a3b2c9142b6495063bdc384">00097</a>     <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;SignalLink&gt;</a> <a class="code" href="a00011.html#a499c0547921ae951bef0d2b30e1a92ad">connect</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> signal, <span class="keyword">const</span> <a class="code" href="a00269.html">SignalSubscriber</a>&amp; subscriber)<span class="keyword"> const</span>
<a name="l00098"></a>00098 <span class="keyword">    </span>{
<a name="l00099"></a>00099       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#aab26dbf8a362a922c3d1ae2ff4ede0ef">connect</a>(signal, subscriber);
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101     <span class="comment">// Cannot inline here, AnyObject not fully declared</span>
<a name="l00102"></a>00102     <a class="code" href="a00206.html">qi::FutureSync&lt;SignalLink&gt;</a> <a class="code" href="a00011.html#a499c0547921ae951bef0d2b30e1a92ad">connect</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> signal, <a class="code" href="a00015.html">AnyObject</a> target, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> slot) <span class="keyword">const</span>;
<a name="l00103"></a><a class="code" href="a00011.html#a49214bd1ea65162373f5ac80b3c214c6">00103</a>     <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;void&gt;</a> <a class="code" href="a00011.html#a49214bd1ea65162373f5ac80b3c214c6">disconnect</a>(<a class="code" href="a00359.html#a69247b0b30dc5f6df95488f18e9aff01">SignalLink</a> linkId)<span class="keyword"> const</span>
<a name="l00104"></a>00104 <span class="keyword">    </span>{
<a name="l00105"></a>00105       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#a78a13b0395b2e5f4b754dfbcbccc5aba" title="Disconnect an event link. Returns if disconnection was successful.">disconnect</a>(linkId);
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00108"></a><a class="code" href="a00011.html#a93ed2186966c12f6962c665e31881530">00108</a>     <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;T&gt;</a> <a class="code" href="a00011.html#a93ed2186966c12f6962c665e31881530">property</a>(<span class="keyword">const</span> std::string&amp; name)<span class="keyword"> const</span>
<a name="l00109"></a>00109 <span class="keyword">    </span>{
<a name="l00110"></a>00110       <span class="keywordflow">return</span> go()-&gt;template property&lt;T&gt;(name);
<a name="l00111"></a>00111     }
<a name="l00112"></a>00112     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00113"></a><a class="code" href="a00011.html#a39f0c71187d4eca791adec70489d64ed">00113</a>     <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;void&gt;</a> <a class="code" href="a00011.html#a39f0c71187d4eca791adec70489d64ed">setProperty</a>(<span class="keyword">const</span> std::string&amp; name, <span class="keyword">const</span> T&amp; val)<span class="keyword"> const</span>
<a name="l00114"></a>00114 <span class="keyword">    </span>{
<a name="l00115"></a>00115       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#ae00cb2545c9dff0f646984e29f0ef8e4">setProperty</a>(name, val);
<a name="l00116"></a>00116     }
<a name="l00117"></a><a class="code" href="a00011.html#a587ecc33f5c33c51678ed73384e7ffa6">00117</a>     <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;AnyValue&gt;</a> <a class="code" href="a00011.html#a93ed2186966c12f6962c665e31881530">property</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>)<span class="keyword"> const</span>
<a name="l00118"></a>00118 <span class="keyword">    </span>{
<a name="l00119"></a>00119       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#ab6b30124ef00001f65d6843c18f265d2">property</a>(<span class="keywordtype">id</span>);
<a name="l00120"></a>00120     }
<a name="l00121"></a><a class="code" href="a00011.html#a490ca6e3d459b17fd96ea4da6ad25216">00121</a>     <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;void&gt;</a> <a class="code" href="a00011.html#a39f0c71187d4eca791adec70489d64ed">setProperty</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="a00024.html">AnyValue</a> &amp;val)<span class="keyword"> const</span>
<a name="l00122"></a>00122 <span class="keyword">    </span>{
<a name="l00123"></a>00123       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#ae00cb2545c9dff0f646984e29f0ef8e4">setProperty</a>(<span class="keywordtype">id</span>, val);
<a name="l00124"></a>00124     }
<a name="l00125"></a><a class="code" href="a00011.html#a44fdf67640a9b0238ee627ed11ecb6ad">00125</a>     <span class="keyword">inline</span> <a class="code" href="a00199.html">ExecutionContext</a>* <a class="code" href="a00011.html#a44fdf67640a9b0238ee627ed11ecb6ad">executionContext</a>()<span class="keyword"> const</span>
<a name="l00126"></a>00126 <span class="keyword">    </span>{
<a name="l00127"></a>00127       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00231.html#abc4c906f99f5f0167fe3338a9fbae938">executionContext</a>().get();
<a name="l00128"></a>00128     }
<a name="l00129"></a><a class="code" href="a00011.html#a09d2a2e840e845a7edceef1fdfb9cf02">00129</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="a00011.html#a09d2a2e840e845a7edceef1fdfb9cf02">isStatsEnabled</a>()<span class="keyword"> const</span>
<a name="l00130"></a>00130 <span class="keyword">    </span>{
<a name="l00131"></a>00131       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00231.html#a08536e8f2d47421132d38ab900cc3f7b">isStatsEnabled</a>();
<a name="l00132"></a>00132     }
<a name="l00133"></a><a class="code" href="a00011.html#afb772ea6335b0dbf1799edc81d4b4739">00133</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00011.html#afb772ea6335b0dbf1799edc81d4b4739">enableStats</a>(<span class="keywordtype">bool</span> enable)<span class="keyword"> const</span>
<a name="l00134"></a>00134 <span class="keyword">    </span>{
<a name="l00135"></a>00135       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00231.html#abd83a0de87a0b80940d10f0873fdb6ed" title="Set statistics gathering status.">enableStats</a>(enable);
<a name="l00136"></a>00136     }
<a name="l00137"></a><a class="code" href="a00011.html#ae11e32968004332cf4c4792c2b2042cb">00137</a>     <span class="keyword">inline</span> <a class="code" href="a00359.html#a8b5a1cd8421b582197e3819ac1f12f6f">ObjectStatistics</a> <a class="code" href="a00011.html#ae11e32968004332cf4c4792c2b2042cb">stats</a>()<span class="keyword"> const</span>
<a name="l00138"></a>00138 <span class="keyword">    </span>{
<a name="l00139"></a>00139       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00231.html#a9a30097a550f9206c9b08bbfb6e94363">stats</a>();
<a name="l00140"></a>00140     }
<a name="l00141"></a><a class="code" href="a00011.html#acb1ae1afbe0cc5b87254f58dd710c3d5">00141</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00011.html#acb1ae1afbe0cc5b87254f58dd710c3d5">clearStats</a>()<span class="keyword"> const</span>
<a name="l00142"></a>00142 <span class="keyword">    </span>{
<a name="l00143"></a>00143       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00231.html#a86af02c51db6dbdedd9b1e9dc1d92d58" title="Reset all statistical data.">clearStats</a>();
<a name="l00144"></a>00144     }
<a name="l00145"></a><a class="code" href="a00011.html#a76509d7bd0cacdab825900dc819c1d82">00145</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="a00011.html#a76509d7bd0cacdab825900dc819c1d82">isTraceEnabled</a>()<span class="keyword"> const</span>
<a name="l00146"></a>00146 <span class="keyword">    </span>{
<a name="l00147"></a>00147       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00231.html#ae32b9f373562752898770fb4763bea3e">isTraceEnabled</a>();
<a name="l00148"></a>00148     }
<a name="l00149"></a><a class="code" href="a00011.html#a37573b5342784b49c34af2ec77636e78">00149</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00011.html#a37573b5342784b49c34af2ec77636e78">enableTrace</a>(<span class="keywordtype">bool</span> enable)
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00231.html#adffd599a4a78702618c4f07ee06656a3">enableTrace</a>(enable);
<a name="l00152"></a>00152     }
<a name="l00153"></a><a class="code" href="a00011.html#a76bf47f16ebea3a4d1427d3d3ce64104">00153</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00011.html#a76bf47f16ebea3a4d1427d3d3ce64104">forceExecutionContext</a>(boost::shared_ptr&lt;qi::ExecutionContext&gt; ec)
<a name="l00154"></a>00154     {
<a name="l00155"></a>00155       <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00231.html#a861bef2bc4eb63719071b86028bcc083" title="Override all ThreadingModel and force dispatch to given event loop.">forceExecutionContext</a>(ec);
<a name="l00156"></a>00156     }
<a name="l00157"></a><a class="code" href="a00415.html#a185d1506ee5bb72a47e4f36207daf1a5">00157</a> <span class="preprocessor">    #define genCall(n, ATYPEDECL, ATYPES, ADECL, AUSE, comma)       \</span>
<a name="l00158"></a>00158 <span class="preprocessor">      template&lt;typename R&gt; qi::Future&lt;R&gt; async(                     \</span>
<a name="l00159"></a>00159 <span class="preprocessor">          const std::string&amp; methodName comma                       \</span>
<a name="l00160"></a>00160 <span class="preprocessor">          QI_GEN_ARGSDECLSAMETYPE(n, qi::AutoAnyReference)) const { \</span>
<a name="l00161"></a>00161 <span class="preprocessor">        return go()-&gt;template async&lt;R&gt;(methodName comma AUSE);      \</span>
<a name="l00162"></a>00162 <span class="preprocessor">      }                                                             \</span>
<a name="l00163"></a>00163 <span class="preprocessor">      template&lt;typename R&gt; R call(                                  \</span>
<a name="l00164"></a>00164 <span class="preprocessor">          const std::string&amp; methodName comma                       \</span>
<a name="l00165"></a>00165 <span class="preprocessor">          QI_GEN_ARGSDECLSAMETYPE(n, qi::AutoAnyReference)) const { \</span>
<a name="l00166"></a>00166 <span class="preprocessor">        return go()-&gt;template call&lt;R&gt;(methodName comma AUSE);       \</span>
<a name="l00167"></a>00167 <span class="preprocessor">      }</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span>    <a class="code" href="a00385.html#a13ce86db8d0df550bc3f38cf6ae2d533">QI_GEN</a>(<a class="code" href="a00415.html#a185d1506ee5bb72a47e4f36207daf1a5">genCall</a>)
<a name="l00169"></a>00169     <span class="preprocessor">#undef genCall</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>
<a name="l00171"></a>00171   <span class="keyword">private</span>:
<a name="l00172"></a>00172     <span class="keyword">inline</span> GenericObject* go()<span class="keyword"> const</span>
<a name="l00173"></a>00173 <span class="keyword">    </span>{
<a name="l00174"></a>00174       GenericObject* g = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>O*<span class="keyword">&gt;</span>(<span class="keyword">this</span>)-&gt;asGenericObject();
<a name="l00175"></a>00175       <span class="keywordflow">if</span> (!g)
<a name="l00176"></a>00176         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;This object is null&quot;</span>);
<a name="l00177"></a>00177       <span class="keywordflow">return</span> g;
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179   };
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00193"></a><a class="code" href="a00015.html">00193</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="a00015.html">Object</a> :
<a name="l00194"></a>00194   <span class="keyword">public</span> detail::GenericObjectBounce&lt;Object&lt;T&gt; &gt;
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196   <span class="comment">// see qi::Future constructors below</span>
<a name="l00197"></a>00197   <span class="keyword">struct </span>None {
<a name="l00198"></a>00198     <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a> _obj;
<a name="l00199"></a>00199   };
<a name="l00200"></a>00200 <span class="keyword">public</span>:
<a name="l00201"></a>00201   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>();
<a name="l00202"></a>00202 
<a name="l00203"></a>00203   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; o);
<a name="l00204"></a>00204   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <span class="keywordtype">void</span> <a class="code" href="a00015.html#a181e3d285f19699b63471ea24a861fba">operator=</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; o);
<a name="l00205"></a>00205   <span class="comment">// Templates above do not replace default ctor or copy operator</span>
<a name="l00206"></a>00206   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object</a>&amp; o);
<a name="l00207"></a>00207   <span class="keywordtype">void</span> <a class="code" href="a00015.html#a181e3d285f19699b63471ea24a861fba">operator=</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object</a>&amp; o);
<a name="l00208"></a>00208   <span class="comment">// Disable the ctor taking future if T is Empty, as it would conflict with</span>
<a name="l00209"></a>00209   <span class="comment">// We use None to disable it. The method must be instantiable because when we</span>
<a name="l00210"></a>00210   <span class="comment">// export the class under windows, all functions are instanciated</span>
<a name="l00211"></a>00211   <span class="comment">// Future cast operator</span>
<a name="l00212"></a><a class="code" href="a00015.html#a3ca880686b069968f8c240a40dbf6d0f">00212</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::mpl::if_&lt;typename boost::is_same&lt;T, Empty&gt;::type, None, <a class="code" href="a00015.html">Object&lt;Empty&gt;</a> &gt;::type <a class="code" href="a00015.html#a3ca880686b069968f8c240a40dbf6d0f">MaybeAnyObject</a>;
<a name="l00213"></a>00213   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(<span class="keyword">const</span> <a class="code" href="a00010.html">qi::Future&lt;MaybeAnyObject&gt;</a>&amp; fobj);
<a name="l00214"></a>00214   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(<span class="keyword">const</span> <a class="code" href="a00206.html">qi::FutureSync&lt;MaybeAnyObject&gt;</a>&amp; fobj);
<a name="l00215"></a>00215 
<a name="l00217"></a>00217 
<a name="l00223"></a>00223   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(<a class="code" href="a00216.html">GenericObject</a>* go);
<a name="l00224"></a>00224   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(T* ptr);
<a name="l00225"></a>00225   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(<a class="code" href="a00216.html">GenericObject</a>* go, boost::function&lt;<span class="keywordtype">void</span>(<a class="code" href="a00216.html">GenericObject</a>*)&gt; deleter);
<a name="l00226"></a>00226   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(T* ptr, boost::function&lt;<span class="keywordtype">void</span>(T*)&gt; deleter);
<a name="l00228"></a>00228 
<a name="l00230"></a>00230   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(<a class="code" href="a00216.html">GenericObject</a>* go, boost::shared_ptr&lt;U&gt; other);
<a name="l00231"></a>00231   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(boost::shared_ptr&lt;U&gt; other);
<a name="l00232"></a>00232   <span class="keywordtype">bool</span> <a class="code" href="a00015.html#a4fba3d68703746160f40c862302b969b">operator &lt;</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object</a>&amp; b) <span class="keyword">const</span>;
<a name="l00233"></a>00233   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <span class="keywordtype">bool</span> <a class="code" href="a00015.html#a1caaca84cdacf83aed3e0cd98f3b12e5">operator !=</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; b) <span class="keyword">const</span>;
<a name="l00234"></a>00234   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <span class="keywordtype">bool</span> <a class="code" href="a00015.html#a9c546af34614da4869f4b7f860d67f91">operator ==</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; b) <span class="keyword">const</span>;
<a name="l00235"></a>00235   <a class="code" href="a00015.html#a10f0b4b06e11d0b1d288a8f72c2ad7ac">operator bool</a>() <span class="keyword">const</span>;
<a name="l00236"></a>00236   <a class="code" href="a00015.html#a4854a3a85fb8a0171ab608873d7a9e62">operator Object&lt;Empty&gt;</a>() <span class="keyword">const</span>;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   boost::shared_ptr&lt;T&gt; <a class="code" href="a00015.html#a5c7a4408a60c804962281577fc4f4e03">asSharedPtr</a>();
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   T&amp; <a class="code" href="a00015.html#af8464ffea6a55f9d6729fcfc1d67e337">asT</a>();
<a name="l00241"></a>00241   <span class="keyword">const</span> T&amp; <a class="code" href="a00015.html#af8464ffea6a55f9d6729fcfc1d67e337">asT</a>() <span class="keyword">const</span>;
<a name="l00242"></a>00242   T* <a class="code" href="a00015.html#a6deba83f9db950f871193020a654df90">operator -&gt;</a>();
<a name="l00243"></a>00243   <span class="keyword">const</span> T* <a class="code" href="a00015.html#a6deba83f9db950f871193020a654df90">operator-&gt;</a>() <span class="keyword">const</span>;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   T&amp; <a class="code" href="a00015.html#a05282cd941ddcabbe67547820bc8a678">operator *</a>();
<a name="l00246"></a>00246   <span class="keyword">const</span> T&amp; <a class="code" href="a00015.html#a05282cd941ddcabbe67547820bc8a678">operator *</a>() <span class="keyword">const</span>;
<a name="l00247"></a>00247   <span class="keywordtype">bool</span> <a class="code" href="a00015.html#afa3cc6aef5721c97048ca8f5bb8c3926">unique</a>() <span class="keyword">const</span>;
<a name="l00248"></a>00248   <a class="code" href="a00216.html">GenericObject</a>* <a class="code" href="a00015.html#a47160fd9fa87ef6c03770c655efeee8d">asGenericObject</a>() <span class="keyword">const</span>;
<a name="l00249"></a>00249   <span class="keywordtype">void</span> <a class="code" href="a00015.html#aa014f09654512b32b21911d274c4de97">reset</a>();
<a name="l00250"></a><a class="code" href="a00015.html#a81f923fdc023e1515db574a6f6edc56d">00250</a>   <span class="keywordtype">unsigned</span> <a class="code" href="a00015.html#a81f923fdc023e1515db574a6f6edc56d">use_count</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _obj.use_count();}
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   <a class="code" href="a00247.html">ObjectTypeInterface</a>* <a class="code" href="a00015.html#a9772aa10e4ca3ca435534d20d0414ae0">interface</a>();
<a name="l00253"></a>00253   <span class="comment">// Check or obtain T interface, or throw</span>
<a name="l00254"></a>00254   <span class="keywordtype">void</span> <a class="code" href="a00015.html#a786f03271079ee8bc61ed2a45124046b" title="Check tha value actually has the T interface.">checkT</a>();
<a name="l00255"></a>00255   <span class="comment">// no-op deletor callback</span>
<a name="l00256"></a><a class="code" href="a00015.html#ac72a733d357ba4ad69ab5b2545ead57d">00256</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#ac72a733d357ba4ad69ab5b2545ead57d">keepManagedObjectPtr</a>(<a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a> ptr) {}
<a name="l00257"></a>00257   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;
<a name="l00258"></a><a class="code" href="a00015.html#ab66721ef1242169425d5ad40ab728416">00258</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#ab66721ef1242169425d5ad40ab728416">keepReference</a>(<a class="code" href="a00216.html">GenericObject</a>* obj, boost::shared_ptr&lt;U&gt; ptr) {<a class="code" href="a00364.html#ab87485b8572032c41e89d03a87bb08f2">qiLogDebug</a>(<span class="stringliteral">&quot;qi.object&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;AnyObject ptr holder deleter&quot;</span>; <span class="keyword">delete</span> obj;}
<a name="l00259"></a><a class="code" href="a00015.html#a28ba648580061d6771c12ffa78804172">00259</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#a28ba648580061d6771c12ffa78804172">noDeleteT</a>(T*) {<a class="code" href="a00364.html#ab87485b8572032c41e89d03a87bb08f2">qiLogDebug</a>(<span class="stringliteral">&quot;qi.object&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;AnyObject noop T deleter&quot;</span>;}
<a name="l00260"></a><a class="code" href="a00015.html#af054c373521cd7a80fc7d784d60b9392">00260</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#af054c373521cd7a80fc7d784d60b9392">noDelete</a>(<a class="code" href="a00216.html">GenericObject</a>*) {<a class="code" href="a00364.html#ab87485b8572032c41e89d03a87bb08f2">qiLogDebug</a>(<span class="stringliteral">&quot;qi.object&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;AnyObject noop deleter&quot;</span>;}
<a name="l00261"></a>00261   <span class="comment">// deletor callback that deletes only the GenericObject and not the content</span>
<a name="l00262"></a><a class="code" href="a00015.html#a5bc663f9a08f5e890fb33ddec574f662">00262</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#a5bc663f9a08f5e890fb33ddec574f662">deleteGenericObjectOnly</a>(<a class="code" href="a00216.html">GenericObject</a>* obj) { <a class="code" href="a00364.html#ab87485b8572032c41e89d03a87bb08f2">qiLogDebug</a>(<span class="stringliteral">&quot;qi.object&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;AnyObject GO deleter&quot;</span>; <span class="keyword">delete</span> obj;}
<a name="l00263"></a>00263   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;
<a name="l00264"></a><a class="code" href="a00015.html#aa5ee0d252677b21cd02e35eb2053c38d">00264</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#aa5ee0d252677b21cd02e35eb2053c38d">deleteGenericObjectOnlyAndKeep</a>(<a class="code" href="a00216.html">GenericObject</a>* obj, U) { <a class="code" href="a00364.html#ab87485b8572032c41e89d03a87bb08f2">qiLogDebug</a>(<span class="stringliteral">&quot;qi.object&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;AnyObject GO-keep deleter&quot;</span>;<span class="keyword">delete</span> obj;}
<a name="l00265"></a><a class="code" href="a00015.html#ab35a5becb8c1c3ab2cdb93de899354b2">00265</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#ab35a5becb8c1c3ab2cdb93de899354b2">deleteCustomDeleter</a>(<a class="code" href="a00216.html">GenericObject</a>* obj, boost::function&lt;<span class="keywordtype">void</span>(T*)&gt; deleter)
<a name="l00266"></a>00266   {
<a name="l00267"></a>00267     <a class="code" href="a00364.html#ab87485b8572032c41e89d03a87bb08f2">qiLogDebug</a>(<span class="stringliteral">&quot;qi.object&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;custom deleter&quot;</span>;
<a name="l00268"></a>00268     deleter((T*)obj-&gt;<a class="code" href="a00216.html#a898961f6de8510908e4e480bf9732a73">value</a>);
<a name="l00269"></a>00269     <span class="keyword">delete</span> obj;
<a name="l00270"></a>00270   }
<a name="l00271"></a><a class="code" href="a00015.html#a9b93468a4a9a0356fb88d0bae0852dbb">00271</a>   <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a> <a class="code" href="a00015.html#a9b93468a4a9a0356fb88d0bae0852dbb">managedObjectPtr</a>() { <span class="keywordflow">return</span> _obj;}
<a name="l00272"></a>00272 <span class="keyword">private</span>:
<a name="l00273"></a><a class="code" href="a00015.html#a0bf7fa513bb0c2b99bd0b16a7824e852">00273</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00216.html">GenericObject</a>;
<a name="l00274"></a>00274 
<a name="l00275"></a><a class="code" href="a00015.html#a63b7f67c2329ef12151eddaf692839c9">00275</a>   <span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt; <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00015.html">Object</a>;
<a name="l00276"></a><a class="code" href="a00015.html#a3c8169d2b04e1be6d58c530e36e6e97e">00276</a>   <span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt; <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00333.html">WeakObject</a>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object</a>(<a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a> obj)
<a name="l00279"></a>00279   {
<a name="l00280"></a>00280     <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(obj);
<a name="l00281"></a>00281   }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="keywordtype">void</span> <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(<a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a> obj);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <span class="keyword">static</span> <span class="keywordtype">void</span> deleteObject(<a class="code" href="a00216.html">GenericObject</a>* obj)
<a name="l00286"></a>00286   {
<a name="l00287"></a>00287     <a class="code" href="a00364.html#ab87485b8572032c41e89d03a87bb08f2">qiLogDebug</a>(<span class="stringliteral">&quot;qi.object&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;deleteObject &quot;</span> &lt;&lt; obj &lt;&lt; <span class="stringliteral">&quot; &quot;</span>
<a name="l00288"></a>00288       &lt;&lt; obj-&gt;<a class="code" href="a00216.html#a898961f6de8510908e4e480bf9732a73">value</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; obj-&gt;<a class="code" href="a00216.html#a9ea46935ffa931fef85c8cd8b6d61cdd">type</a>-&gt;<a class="code" href="a00315.html#a2ab1dbbc7cb93011ad74564036254076">infoString</a>();
<a name="l00289"></a>00289     obj-&gt;<a class="code" href="a00216.html#a9ea46935ffa931fef85c8cd8b6d61cdd">type</a>-&gt;<a class="code" href="a00315.html#a162854390559504bfc239a3d29065e61" title="Free all resources of a storage.">destroy</a>(obj-&gt;<a class="code" href="a00216.html#a898961f6de8510908e4e480bf9732a73">value</a>);
<a name="l00290"></a>00290     <span class="keyword">delete</span> obj;
<a name="l00291"></a>00291   }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   <span class="comment">/* Do not change this, Object&lt;T&gt; must be binary-equivalent to</span>
<a name="l00294"></a>00294 <span class="comment">   * ManagedObjectPtr.</span>
<a name="l00295"></a>00295 <span class="comment">   */</span>
<a name="l00296"></a>00296   <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a> _obj;
<a name="l00297"></a>00297 };
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="a00333.html">00299</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="a00333.html">WeakObject</a>
<a name="l00300"></a>00300 {
<a name="l00301"></a>00301 <span class="keyword">public</span>:
<a name="l00302"></a><a class="code" href="a00333.html#ad9c4029a9eafcc1c670ae0109587fa8c">00302</a>   <a class="code" href="a00333.html#ad9c4029a9eafcc1c670ae0109587fa8c">WeakObject</a>() {}
<a name="l00303"></a><a class="code" href="a00333.html#afe9b2ea41c2860301c66bc1d3580ee2d">00303</a>   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <a class="code" href="a00333.html#ad9c4029a9eafcc1c670ae0109587fa8c">WeakObject</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; o)
<a name="l00304"></a>00304   : <a class="code" href="a00333.html#a6310ce4f446e40191daeb65ee3aec45b">_ptr</a>(o._obj) {}
<a name="l00305"></a><a class="code" href="a00333.html#a6bdf619922edc3fd49daadc01643a640">00305</a>   <a class="code" href="a00015.html">Object&lt;T&gt;</a> <a class="code" href="a00333.html#a6bdf619922edc3fd49daadc01643a640">lock</a>() { <span class="keywordflow">return</span> <a class="code" href="a00015.html">Object&lt;T&gt;</a>(<a class="code" href="a00333.html#a6310ce4f446e40191daeb65ee3aec45b">_ptr</a>.lock());}
<a name="l00306"></a><a class="code" href="a00333.html#a6310ce4f446e40191daeb65ee3aec45b">00306</a>   boost::weak_ptr&lt;GenericObject&gt; <a class="code" href="a00333.html#a6310ce4f446e40191daeb65ee3aec45b">_ptr</a>;
<a name="l00307"></a>00307 };
<a name="l00308"></a><a class="code" href="a00359.html#a984d5fa8d8f50699c31a3da9bca5b63a">00308</a> <span class="keyword">typedef</span> <a class="code" href="a00333.html">WeakObject&lt;Empty&gt;</a> <a class="code" href="a00359.html#a984d5fa8d8f50699c31a3da9bca5b63a">AnyWeakObject</a>;
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="a00015.html#a9772aa10e4ca3ca435534d20d0414ae0">00310</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00247.html">ObjectTypeInterface</a>* <a class="code" href="a00015.html#a9772aa10e4ca3ca435534d20d0414ae0">Object&lt;T&gt;::interface</a>()
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312   <a class="code" href="a00315.html">TypeInterface</a>* type = typeOf&lt;T&gt;();
<a name="l00313"></a>00313   <span class="keywordflow">if</span> (type-&gt;<a class="code" href="a00315.html#a2e9435156f2cbbb224c97355311c1665">kind</a>() != <a class="code" href="a00359.html#ae01d947882857905031a3773561d3d83a3fdef608736434b0ed3db23409166f45">TypeKind_Object</a>)
<a name="l00314"></a>00314   {
<a name="l00315"></a>00315     <span class="comment">// Try template</span>
<a name="l00316"></a>00316     <a class="code" href="a00278.html">TemplateTypeInterface</a>* t = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="a00278.html">TemplateTypeInterface</a>*<span class="keyword">&gt;</span>(type);
<a name="l00317"></a>00317     <span class="keywordflow">if</span> (t)
<a name="l00318"></a>00318       type = t-&gt;<a class="code" href="a00278.html#afbfc6b5a6ce384c7ac2623daff7bcb7c">next</a>();
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (type-&gt;<a class="code" href="a00315.html#a2e9435156f2cbbb224c97355311c1665">kind</a>() != <a class="code" href="a00359.html#ae01d947882857905031a3773561d3d83a3fdef608736434b0ed3db23409166f45">TypeKind_Object</a>)
<a name="l00320"></a>00320     {
<a name="l00321"></a>00321       std::stringstream err;
<a name="l00322"></a>00322       err &lt;&lt; <span class="stringliteral">&quot;Object&lt;T&gt; can only be used on registered object types. (&quot;</span>
<a name="l00323"></a>00323       &lt;&lt; type-&gt;<a class="code" href="a00315.html#a2ab1dbbc7cb93011ad74564036254076">infoString</a>() &lt;&lt; <span class="stringliteral">&quot;)(&quot;</span> &lt;&lt; type-&gt;<a class="code" href="a00315.html#a2e9435156f2cbbb224c97355311c1665">kind</a>() &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;
<a name="l00324"></a>00324       <span class="keywordflow">throw</span> std::runtime_error(err.str());
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326   }
<a name="l00327"></a>00327   <a class="code" href="a00247.html">ObjectTypeInterface</a>* otype = <span class="keyword">static_cast&lt;</span><a class="code" href="a00247.html">ObjectTypeInterface</a>*<span class="keyword">&gt;</span>(type);
<a name="l00328"></a>00328   <span class="keywordflow">return</span> otype;
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>() {}
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00334"></a>00334 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;
<a name="l00335"></a><a class="code" href="a00015.html#a2b8f30a6bf025643d969e6a4bf922fba">00335</a> <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; o)
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337   <span class="keyword">static</span> <span class="keywordtype">bool</span> unused = <a class="code" href="a00094.html">qi::detail::ForceProxyInclusion&lt;T&gt;</a>().dummyCall();
<a name="l00338"></a>00338   (void)unused;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="comment">/* An Object&lt;T&gt; created by convert may be in fact an object that does</span>
<a name="l00341"></a>00341 <span class="comment">  * not implement the T interface.</span>
<a name="l00342"></a>00342 <span class="comment">  * Checking and converting on first access to T&amp; is not enough:</span>
<a name="l00343"></a>00343 <span class="comment">  *  Object&lt;Iface&gt; o = obj.call(&quot;fetchOne&quot;); // this one might be incorrect</span>
<a name="l00344"></a>00344 <span class="comment">  *  someVector.push_back(o); // pushes the incorrect one</span>
<a name="l00345"></a>00345 <span class="comment">  *  o-&gt;someIfaceOperation(); // will upgrade o, but not the one in someVector</span>
<a name="l00346"></a>00346 <span class="comment">  *</span>
<a name="l00347"></a>00347 <span class="comment">  * So we check as early as we can, in all copy pathes, and back-propagate</span>
<a name="l00348"></a>00348 <span class="comment">  * the upgrade to the source of the copy</span>
<a name="l00349"></a>00349 <span class="comment">  */</span>
<a name="l00350"></a>00350   <span class="keyword">const_cast&lt;</span><a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp;<span class="keyword">&gt;</span>(o).checkT();
<a name="l00351"></a>00351   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(o._obj);
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00354"></a>00354 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;
<a name="l00355"></a><a class="code" href="a00015.html#a181e3d285f19699b63471ea24a861fba">00355</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#a181e3d285f19699b63471ea24a861fba">Object&lt;T&gt;::operator=</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; o)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357   <span class="keyword">static</span> <span class="keywordtype">bool</span> unused = <a class="code" href="a00094.html">qi::detail::ForceProxyInclusion&lt;T&gt;</a>().dummyCall();
<a name="l00358"></a>00358   (void)unused;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <span class="keyword">const_cast&lt;</span><a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp;<span class="keyword">&gt;</span>(o).checkT();
<a name="l00361"></a>00361   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(o._obj);
<a name="l00362"></a>00362 }
<a name="l00363"></a><a class="code" href="a00015.html#ab58f89e429e6ed7e715df2feb2cd7f53">00363</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;T&gt;</a>&amp; o)
<a name="l00364"></a>00364 {
<a name="l00365"></a>00365   <span class="keyword">const_cast&lt;</span><a class="code" href="a00015.html">Object&lt;T&gt;</a>&amp;<span class="keyword">&gt;</span>(o).checkT();
<a name="l00366"></a>00366   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(o._obj);
<a name="l00367"></a>00367 }
<a name="l00368"></a><a class="code" href="a00015.html#a62e5f877c0507e2e07e5c25856f5264b">00368</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html#a181e3d285f19699b63471ea24a861fba">Object&lt;T&gt;::operator=</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;T&gt;</a>&amp; o)
<a name="l00369"></a>00369 {
<a name="l00370"></a>00370   <span class="keyword">const_cast&lt;</span><a class="code" href="a00015.html">Object&lt;T&gt;</a>&amp;<span class="keyword">&gt;</span>(o).checkT();
<a name="l00371"></a>00371   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(o._obj);
<a name="l00372"></a>00372 }
<a name="l00373"></a><a class="code" href="a00015.html#a4f4340ea473619f9f52978f619f16ec0">00373</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(<a class="code" href="a00216.html">GenericObject</a>* go)
<a name="l00374"></a>00374 {
<a name="l00375"></a>00375   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(<a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a>(go, &amp;deleteObject));
<a name="l00376"></a>00376 }
<a name="l00377"></a><a class="code" href="a00015.html#aa3effee5f293e97f07322fb2390497fd">00377</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(<a class="code" href="a00216.html">GenericObject</a>* go, boost::function&lt;<span class="keywordtype">void</span>(<a class="code" href="a00216.html">GenericObject</a>*)&gt; deleter)
<a name="l00378"></a>00378 {
<a name="l00379"></a>00379   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(<a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a>(go, deleter));
<a name="l00380"></a>00380 }
<a name="l00381"></a><a class="code" href="a00015.html#ab314d71a1ab05b709b44c043d94cd7d6">00381</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(<a class="code" href="a00216.html">GenericObject</a>* go, boost::shared_ptr&lt;U&gt; other)
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(<a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a>(other, go));
<a name="l00384"></a>00384   <span class="comment">// Notify the shared_from_this of GenericObject</span>
<a name="l00385"></a>00385   _obj-&gt;_internal_accept_owner(&amp;other, go);
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 <span class="keyword">namespace </span>detail
<a name="l00388"></a>00388 {
<a name="l00389"></a><a class="code" href="a00450.html#a6cd76fbcc8f635097dea430f3b3bee68">00389</a>   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">ManagedObjectPtr</a> <a class="code" href="a00450.html#a6cd76fbcc8f635097dea430f3b3bee68">fromSharedPtr</a>(<a class="code" href="a00015.html">Object&lt;T&gt;</a>&amp; dst, boost::shared_ptr&lt;U&gt;&amp; other, boost::false_type)
<a name="l00390"></a>00390   {
<a name="l00391"></a>00391     <a class="code" href="a00247.html">ObjectTypeInterface</a>* otype = dst.<a class="code" href="a00015.html#a9772aa10e4ca3ca435534d20d0414ae0">interface</a>();
<a name="l00392"></a>00392     T* ptr = <span class="keyword">static_cast&lt;</span>T*<span class="keyword">&gt;</span>(other.get());
<a name="l00393"></a>00393     <span class="keywordflow">return</span> <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">ManagedObjectPtr</a>(<span class="keyword">new</span> <a class="code" href="a00216.html">GenericObject</a>(otype, ptr),
<a name="l00394"></a>00394       <a class="code" href="a00359.html#a22ca99743b6c820547dea46057a73ae0">boost::bind</a>(&amp;<a class="code" href="a00015.html">Object&lt;T&gt;::template</a> keepReference&lt;U&gt;, _1, other));
<a name="l00395"></a>00395   }
<a name="l00396"></a><a class="code" href="a00450.html#a240b1f451b239c7730ba9e7d4710f36f">00396</a>   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">ManagedObjectPtr</a> <a class="code" href="a00450.html#a6cd76fbcc8f635097dea430f3b3bee68">fromSharedPtr</a>(<a class="code" href="a00015.html">AnyObject</a>&amp; dst, boost::shared_ptr&lt;U&gt;&amp; other, boost::true_type)
<a name="l00397"></a>00397   {
<a name="l00398"></a>00398     <span class="keywordflow">return</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>(other).managedObjectPtr();
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a><a class="code" href="a00015.html#a1090798d9d176e97908b77a97211ca5f">00402</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(boost::shared_ptr&lt;U&gt; other)
<a name="l00403"></a>00403 { <span class="comment">// bounce depending on T==Empty</span>
<a name="l00404"></a>00404   _obj = <a class="code" href="a00450.html#a6cd76fbcc8f635097dea430f3b3bee68">detail::fromSharedPtr</a>(*<span class="keyword">this</span>, other, <span class="keyword">typename</span> boost::is_same&lt;T, Empty&gt;::type());
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="a00015.html#af801e7006bd60be33aa5c896bc84a508">00407</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(T* ptr)
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409   <a class="code" href="a00247.html">ObjectTypeInterface</a>* otype = interface();
<a name="l00410"></a>00410   _obj = <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a>(<span class="keyword">new</span> <a class="code" href="a00216.html">GenericObject</a>(otype, ptr), &amp;deleteObject);
<a name="l00411"></a>00411 }
<a name="l00412"></a><a class="code" href="a00015.html#a5544feab9c0ce9f58a3102b9c140d902">00412</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(T* ptr, boost::function&lt;<span class="keywordtype">void</span>(T*)&gt; deleter)
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414   <a class="code" href="a00247.html">ObjectTypeInterface</a>* otype = interface();
<a name="l00415"></a>00415   <span class="keywordflow">if</span> (deleter)
<a name="l00416"></a>00416     _obj = <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a>(<span class="keyword">new</span> <a class="code" href="a00216.html">GenericObject</a>(otype, ptr),
<a name="l00417"></a>00417       <a class="code" href="a00359.html#a22ca99743b6c820547dea46057a73ae0">boost::bind</a>(&amp;<a class="code" href="a00015.html#ab35a5becb8c1c3ab2cdb93de899354b2">Object::deleteCustomDeleter</a>, _1, deleter));
<a name="l00418"></a>00418   <span class="keywordflow">else</span>
<a name="l00419"></a>00419     _obj = <a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a>(<span class="keyword">new</span> <a class="code" href="a00216.html">GenericObject</a>(otype, ptr), &amp;deleteObject);
<a name="l00420"></a>00420 }
<a name="l00421"></a><a class="code" href="a00015.html#a0a3c8913f49b4a616e2606d2843d6bad">00421</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(<span class="keyword">const</span> <a class="code" href="a00010.html">qi::Future&lt;MaybeAnyObject&gt;</a>&amp; fobj)
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423   <span class="keyword">static</span> <span class="keywordtype">bool</span> unused = <a class="code" href="a00094.html">qi::detail::ForceProxyInclusion&lt;T&gt;</a>().dummyCall();
<a name="l00424"></a>00424   (void)unused;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(fobj.<a class="code" href="a00010.html#ad12c5183cb847854693348ed8d362e45" title="Return the value associated to a Future.">value</a>()._obj);
<a name="l00427"></a>00427 }
<a name="l00428"></a><a class="code" href="a00015.html#a30643446fcf4665f84a7b140eacbda16">00428</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <a class="code" href="a00015.html#a877bce48418c5c33badb683c124775f1">Object&lt;T&gt;::Object</a>(<span class="keyword">const</span> <a class="code" href="a00206.html">qi::FutureSync&lt;MaybeAnyObject&gt;</a>&amp; fobj)
<a name="l00429"></a>00429 {
<a name="l00430"></a>00430   <span class="keyword">static</span> <span class="keywordtype">bool</span> unused = <a class="code" href="a00094.html">qi::detail::ForceProxyInclusion&lt;T&gt;</a>().dummyCall();
<a name="l00431"></a>00431   (void)unused;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433   <a class="code" href="a00365.html#aeab86bded40d3c9b6695eb6700b30040" title="Initialization of the logging system (could be avoided)">init</a>(fobj.<a class="code" href="a00206.html#afe28b79376f7e8390648ac74bf5ab63f">value</a>()._obj);
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a><a class="code" href="a00015.html#a5c7a4408a60c804962281577fc4f4e03">00436</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> boost::shared_ptr&lt;T&gt; <a class="code" href="a00015.html#a5c7a4408a60c804962281577fc4f4e03">Object&lt;T&gt;::asSharedPtr</a>()
<a name="l00437"></a>00437 {
<a name="l00438"></a>00438   checkT();
<a name="l00439"></a>00439   <span class="keywordflow">return</span> boost::shared_ptr&lt;T&gt;(&amp;asT(), <a class="code" href="a00359.html#a22ca99743b6c820547dea46057a73ae0">boost::bind</a>(&amp;keepManagedObjectPtr, _obj));
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="a00015.html">Object&lt;T&gt;::init</a>(<a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a> obj)
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444   _obj = obj;
<a name="l00445"></a>00445   <span class="keywordflow">if</span> (!boost::is_same&lt;T, Empty&gt;::value &amp;&amp; obj)
<a name="l00446"></a>00446     checkT();
<a name="l00447"></a>00447   _obj = obj;
<a name="l00448"></a>00448 }
<a name="l00449"></a>00449 
<a name="l00450"></a><a class="code" href="a00015.html#a4fba3d68703746160f40c862302b969b">00450</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="a00015.html#a4fba3d68703746160f40c862302b969b">Object&lt;T&gt;::operator &lt;</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object</a>&amp; b)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _obj &lt; b._obj;}
<a name="l00451"></a><a class="code" href="a00015.html#a1caaca84cdacf83aed3e0cd98f3b12e5">00451</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <span class="keywordtype">bool</span> <a class="code" href="a00015.html#a1caaca84cdacf83aed3e0cd98f3b12e5">Object&lt;T&gt;::operator !=</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; b)<span class="keyword"> const</span>
<a name="l00452"></a>00452 <span class="keyword"></span>{
<a name="l00453"></a>00453   <span class="keywordflow">return</span> !(*<span class="keyword">this</span> ==b);
<a name="l00454"></a>00454 }
<a name="l00455"></a><a class="code" href="a00015.html#a9c546af34614da4869f4b7f860d67f91">00455</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <span class="keywordtype">bool</span> <a class="code" href="a00015.html#a9c546af34614da4869f4b7f860d67f91">Object&lt;T&gt;::operator ==</a>(<span class="keyword">const</span> <a class="code" href="a00015.html">Object&lt;U&gt;</a>&amp; b)<span class="keyword"> const</span>
<a name="l00456"></a>00456 <span class="keyword"></span>{
<a name="l00457"></a>00457   <span class="keywordflow">return</span> asGenericObject() == b.<a class="code" href="a00015.html#a47160fd9fa87ef6c03770c655efeee8d">asGenericObject</a>();
<a name="l00458"></a>00458 }
<a name="l00459"></a><a class="code" href="a00015.html#a10f0b4b06e11d0b1d288a8f72c2ad7ac">00459</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="a00015.html#a10f0b4b06e11d0b1d288a8f72c2ad7ac">Object&lt;T&gt;::operator bool</a>()<span class="keyword"> const   </span>{ <span class="keywordflow">return</span> _obj &amp;&amp; _obj-&gt;type;}
<a name="l00460"></a>00460 
<a name="l00461"></a><a class="code" href="a00015.html#a4854a3a85fb8a0171ab608873d7a9e62">00461</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="a00015.html#a4854a3a85fb8a0171ab608873d7a9e62">Object&lt;T&gt;::operator Object&lt;Empty&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="a00015.html">Object&lt;Empty&gt;</a>(_obj);}
<a name="l00463"></a><a class="code" href="a00015.html#a786f03271079ee8bc61ed2a45124046b">00463</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="a00015.html#a786f03271079ee8bc61ed2a45124046b" title="Check tha value actually has the T interface.">Object&lt;T&gt;::checkT</a>()
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465   <span class="keywordflow">if</span> (boost::is_same&lt;T, Empty&gt;::value || !_obj)
<a name="l00466"></a>00466     <span class="keywordflow">return</span>;
<a name="l00467"></a>00467   <span class="keywordflow">if</span> (_obj-&gt;type-&gt;info() != typeOf&lt;T&gt;()-&gt;info()
<a name="l00468"></a>00468     &amp;&amp; _obj-&gt;type-&gt;inherits(typeOf&lt;T&gt;())==-1)
<a name="l00469"></a>00469   { <span class="comment">// No T interface, try upgrading _obj</span>
<a name="l00470"></a>00470     <a class="code" href="a00450.html#ab8cc0dd9a97f34037fd51e23fb44dcfb">detail::ProxyGeneratorMap</a>&amp; map = <a class="code" href="a00450.html#a6e5ba51d10e9a83329a3222be8cd3783">detail::proxyGeneratorMap</a>();
<a name="l00471"></a>00471     detail::ProxyGeneratorMap::iterator it = map.find(typeOf&lt;T&gt;()-&gt;info());
<a name="l00472"></a>00472     <span class="keywordflow">if</span> (it != map.end())
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474       <a class="code" href="a00364.html#ab87485b8572032c41e89d03a87bb08f2">qiLogDebug</a>(<span class="stringliteral">&quot;qitype.anyobject&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Upgrading Object to specialized proxy.&quot;</span>;
<a name="l00475"></a>00475       <a class="code" href="a00023.html">AnyReference</a> ref = it-&gt;second(<a class="code" href="a00359.html#a0e60a9cbccf0a2138b4f838b9ccd356a">AnyObject</a>(_obj));
<a name="l00476"></a>00476       _obj = ref.<a class="code" href="a00054.html#a945cd732b50108a3c194c2f1fbc1c8a6" title="Convert to anything or throw trying.">to</a>&lt;<a class="code" href="a00450.html#ab4f5c39044ff03ce82a714a18ccf8986">detail::ManagedObjectPtr</a>&gt;();
<a name="l00477"></a>00477       ref.<a class="code" href="a00054.html#aed0cd8020f0f770d7374a8908df57bb9" title="Deletes storage.">destroy</a>();
<a name="l00478"></a>00478       <span class="keywordflow">return</span>;
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480     <span class="keywordflow">throw</span> std::runtime_error(std::string() + <span class="stringliteral">&quot;Object does not have interface &quot;</span> + typeOf&lt;T&gt;()-&gt;infoString());
<a name="l00481"></a>00481   }
<a name="l00482"></a>00482 }
<a name="l00483"></a><a class="code" href="a00015.html#af8464ffea6a55f9d6729fcfc1d67e337">00483</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; T&amp; <a class="code" href="a00015.html#af8464ffea6a55f9d6729fcfc1d67e337">Object&lt;T&gt;::asT</a>()
<a name="l00484"></a>00484 {
<a name="l00485"></a>00485   checkT();
<a name="l00486"></a>00486   <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span>T*<span class="keyword">&gt;</span>(_obj-&gt;value);
<a name="l00487"></a>00487 }
<a name="l00488"></a><a class="code" href="a00015.html#a8d0178493af37061e691048b78ce81cd">00488</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">const</span> T&amp; <a class="code" href="a00015.html#af8464ffea6a55f9d6729fcfc1d67e337">Object&lt;T&gt;::asT</a>()<span class="keyword"> const</span>
<a name="l00489"></a>00489 <span class="keyword"></span>{
<a name="l00490"></a>00490   <span class="keyword">const_cast&lt;</span><a class="code" href="a00015.html">Object&lt;T&gt;</a>* <span class="keyword">&gt;</span>(<span class="keyword">this</span>)-&gt;checkT();
<a name="l00491"></a>00491   <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>T*<span class="keyword">&gt;</span>(_obj-&gt;value);
<a name="l00492"></a>00492 }
<a name="l00493"></a><a class="code" href="a00015.html#a6deba83f9db950f871193020a654df90">00493</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; T* <a class="code" href="a00015.html#a6deba83f9db950f871193020a654df90">Object&lt;T&gt;::operator -&gt;</a>()
<a name="l00494"></a>00494 {
<a name="l00495"></a>00495     <span class="keywordflow">return</span> &amp;asT();
<a name="l00496"></a>00496 }
<a name="l00497"></a><a class="code" href="a00015.html#aab02b0d141921a50dee68dca6b48c1e6">00497</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">const</span> T* <a class="code" href="a00015.html#a6deba83f9db950f871193020a654df90">Object&lt;T&gt;::operator-&gt;</a>()<span class="keyword"> const</span>
<a name="l00498"></a>00498 <span class="keyword"></span>{
<a name="l00499"></a>00499   <span class="keywordflow">return</span> &amp;asT();
<a name="l00500"></a>00500 }
<a name="l00501"></a><a class="code" href="a00015.html#a05282cd941ddcabbe67547820bc8a678">00501</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; T&amp; <a class="code" href="a00015.html#a05282cd941ddcabbe67547820bc8a678">Object&lt;T&gt;::operator *</a>()
<a name="l00502"></a>00502 {
<a name="l00503"></a>00503   <span class="keywordflow">return</span> asT();
<a name="l00504"></a>00504 }
<a name="l00505"></a><a class="code" href="a00015.html#a8f4edda1e0244384282fe889b406224d">00505</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">const</span> T&amp; <a class="code" href="a00015.html#a05282cd941ddcabbe67547820bc8a678">Object&lt;T&gt;::operator *</a>()<span class="keyword"> const</span>
<a name="l00506"></a>00506 <span class="keyword"></span>{
<a name="l00507"></a>00507   <span class="keywordflow">return</span> asT();
<a name="l00508"></a>00508 }
<a name="l00509"></a><a class="code" href="a00015.html#afa3cc6aef5721c97048ca8f5bb8c3926">00509</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="a00015.html#afa3cc6aef5721c97048ca8f5bb8c3926">Object&lt;T&gt;::unique</a>()<span class="keyword"> const</span>
<a name="l00510"></a>00510 <span class="keyword"></span>{
<a name="l00511"></a>00511   <span class="keywordflow">return</span> _obj.unique();
<a name="l00512"></a>00512 }
<a name="l00513"></a><a class="code" href="a00015.html#a47160fd9fa87ef6c03770c655efeee8d">00513</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="a00216.html">GenericObject</a>* <a class="code" href="a00015.html#a47160fd9fa87ef6c03770c655efeee8d">Object&lt;T&gt;::asGenericObject</a>()<span class="keyword"> const</span>
<a name="l00514"></a>00514 <span class="keyword"></span>{
<a name="l00515"></a>00515   <span class="keywordflow">return</span> _obj.get();
<a name="l00516"></a>00516 }
<a name="l00517"></a><a class="code" href="a00015.html#aa014f09654512b32b21911d274c4de97">00517</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="a00015.html#aa014f09654512b32b21911d274c4de97">Object&lt;T&gt;::reset</a>()
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519   _obj.reset();
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 <span class="keyword">namespace </span>detail
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> O&gt;
<a name="l00525"></a><a class="code" href="a00011.html#a65103449af55f58143ace0bccfb0db9d">00525</a>   <span class="keyword">inline</span> <a class="code" href="a00206.html">qi::FutureSync&lt;SignalLink&gt;</a> <a class="code" href="a00011.html#a499c0547921ae951bef0d2b30e1a92ad">GenericObjectBounce&lt;O&gt;::connect</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> signal, <a class="code" href="a00015.html">AnyObject</a> target, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> slot)<span class="keyword"> const</span>
<a name="l00526"></a>00526 <span class="keyword">  </span>{
<a name="l00527"></a>00527     <span class="keywordflow">return</span> go()-&gt;<a class="code" href="a00216.html#aab26dbf8a362a922c3d1ae2ff4ede0ef">connect</a>(signal, target, slot);
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 <span class="comment">/* Pretend that Object&lt;T&gt; is exactly shared_ptr&lt;GenericObject&gt;</span>
<a name="l00532"></a>00532 <span class="comment"> * Which it is in terms of memory layout.</span>
<a name="l00533"></a>00533 <span class="comment"> * But as a consequence, convert will happily create Object&lt;T&gt; for any T</span>
<a name="l00534"></a>00534 <span class="comment"> * without checking it.</span>
<a name="l00535"></a>00535 <span class="comment"> * Object&lt;T&gt; is handling this through the checkT() method.</span>
<a name="l00536"></a>00536 <span class="comment"> */</span>
<a name="l00537"></a>00537 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00538"></a><a class="code" href="a00301.html">00538</a> <span class="keyword">class </span><a class="code" href="a00340.html#ac45a270021d1bfae15cc079cbc39c4a4">QI_API</a> <a class="code" href="a00293.html">TypeImpl</a>&lt;<a class="code" href="a00015.html">Object</a>&lt;T&gt; &gt; :
<a name="l00539"></a>00539   <span class="keyword">public</span> <a class="code" href="a00293.html">TypeImpl</a>&lt;boost::shared_ptr&lt;GenericObject&gt; &gt;
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541 };
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00544"></a>00544 <span class="preprocessor"></span><span class="comment">/* Because we use types marked with QI_API and inheriting from Object&lt;Empty&gt;</span>
<a name="l00545"></a>00545 <span class="comment"> * (through AnyObject), then Object&lt;Empty&gt; functions must be explicitly</span>
<a name="l00546"></a>00546 <span class="comment"> * exported/imported to avoid link issues with MSVC.</span>
<a name="l00547"></a>00547 <span class="comment"> */</span>
<a name="l00548"></a>00548 <span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="a00340.html#ac45a270021d1bfae15cc079cbc39c4a4">QI_API</a> <a class="code" href="a00015.html">Object&lt;Empty&gt;</a>;
<a name="l00549"></a>00549 <span class="preprocessor">#endif</span>
<a name="l00550"></a>00550 <span class="preprocessor"></span>
<a name="l00551"></a>00551 }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 <span class="preprocessor">#endif  // _QITYPE_DETAILS_GENERICOBJECT_HXX_</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Copyright Aldebaran Robotics
<!-- Generated on Wed Oct 29 2014 16:04:34 for libqi-api by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1</small></address> -->

</body>
</html>
