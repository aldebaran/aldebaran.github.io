
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>qi::EventLoop &mdash; qi SDK Documentation 2.2.0.55 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.0.55',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="qi SDK Documentation 2.2.0.55 documentation" href="../../index.html" />
    <link rel="up" title="C++ qi API Reference" href="index.html" />
    <link rel="next" title="qi::Promise, qi::Future" href="future.html" />
    <link rel="prev" title="qi::DynamicObjectBuilder" href="dynamicobjectbuilder.html" />
 
<script>
$(window).ready(function () {
    var width_label = 0;
    $('dl.function-index dt > span').each(function () {
        $(this).css('width', 'auto');
        width_label = Math.max(width_label, $(this).width());
    }).width(width_label + 30);
    $('.sig-paren').width('auto');
})

</script>


<script type="text/javascript" src="/static/js/ga-status.js"></script>



  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      <h1><a href="../../index.html">qi SDK Documentation 2.2.0.55 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>
         |
        <a title="Site map" href="../../contents.html">Site map</a>
         |
        <a title="Search" href="../../search.html">Search</a>
         |
        <a title="Index" href="../../genindex.html">Index</a>
      </div>
      <div class="nav">
    &laquo; <a href="dynamicobjectbuilder.html" title="qi::DynamicObjectBuilder">previous</a>
     |
    <a href="index.html" title="C++ qi API Reference" accesskey="U">up</a>
   |
    <a href="future.html" title="qi::Promise, qi::Future">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="api-cpp-eventloop">
            
  <div class="section" id="qi-eventloop">
<h1>qi::EventLoop<a class="headerlink" href="#qi-eventloop" title="Permalink to this headline">¶</a></h1>
<p>Provide an eventloop based on boost::asio.</p>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<strong><p class="rubric">Global Namespaces</p>
</strong><ul>
<li><p class="first">namespace qi</p>
<dl class="docutils">
<strong><p class="rubric">Classes (namespace qi)</p>
</strong><ul>
<li><p class="first">class qi::EventLoop</p>
<dl class="docutils">
<strong><p class="rubric">Functions (class qi::EventLoop)</p>
</strong><ul class="simple">
<a class="reference internal" href="#qi::EventLoop::setEmergencyCallback__boost::function:void:">qi::EventLoop::setEmergencyCallback</a><p><a class="reference internal" href="#qi::EventLoop::join">qi::EventLoop::join</a></p>
<p><a class="reference internal" href="#qi::EventLoop::monitorEventLoop__EventLoopP.uint64_t">qi::EventLoop::monitorEventLoop</a></p>
<p><a class="reference internal" href="#qi::EventLoop::stop">qi::EventLoop::stop</a></p>
<p><a class="reference internal" href="#qi::EventLoop::~EventLoop">qi::EventLoop::~EventLoop</a></p>
<p><a class="reference internal" href="#qi::EventLoop::async__boost::function:R:CR.uint64_t">qi::EventLoop::async</a></p>
<p><a class="reference internal" href="#qi::EventLoop::isInThisContext">qi::EventLoop::isInThisContext</a></p>
<p><a class="reference internal" href="#qi::EventLoop::setMaxThreads__unsigned-i">qi::EventLoop::setMaxThreads</a></p>
<p><a class="reference internal" href="#qi::EventLoop::start__i">qi::EventLoop::start</a></p>
<p><a class="reference internal" href="#qi::EventLoop::nativeHandle">qi::EventLoop::nativeHandle</a></p>
<p><a class="reference internal" href="#qi::EventLoop::post__boost::function:void:CR.uint64_t">qi::EventLoop::post</a></p>
<p><a class="reference internal" href="#qi::EventLoop::EventLoop__ssCR">qi::EventLoop::EventLoop</a></p>
</ul>
</dl>
</li>
</ul>
<strong><p class="rubric">Functions (namespace qi)</p>
</strong><ul class="simple">
<a class="reference internal" href="#qi::getIoService">qi::getIoService</a><p><a class="reference internal" href="#qi::getEventLoop">qi::getEventLoop</a></p>
<p><a class="reference internal" href="#qi::startEventLoop__i">qi::startEventLoop</a></p>
<p><a class="reference internal" href="#qi::async__boost::function:R:.uint64_t">qi::async</a></p>
</ul>
</dl>
</li>
</ul>
</dl>
</div>
<div class="section" id="detailed-description">
<h2>Detailed Description<a class="headerlink" href="#detailed-description" title="Permalink to this headline">¶</a></h2>
<p>This eventloop consists of a threadpool of boost::asio threads waiting for
work. You can schedule work using <a class="reference internal" href="#qi::async__boost::function:R:.uint64_t" title="qi::async"><tt class="xref cpp cpp-guess docutils literal"><span class="pre">async</span></tt></a> or using the <tt class="docutils literal"><span class="pre">io_service</span></tt> directly
(to do asynchronous operations on sockets for example). Most basic usages are
described in <a class="reference internal" href="../../guide/cxx-async.html#guide-cxx-async"><em>asynchronous operations</em></a>.</p>
<div class="section" id="good-use-of-a-threadpool">
<h3>Good use of a threadpool<a class="headerlink" href="#good-use-of-a-threadpool" title="Permalink to this headline">¶</a></h3>
<p>It is often needed to schedule asynchronous work so that multiple work can be
done in parallel. One way to do such a thing is to spawn a thread for the task
and have the thread quit when the task is finished. It is bad practice to do
such things. Spawning and exiting threads is costly in performance and must be
avoided.</p>
<p>A threadpool starts a bunch of threads at its initialization and allows one to
schedule short tasks on it, this avoids thread creations/destructions.</p>
<div class="section" id="blocking-threads">
<h4>Blocking threads<a class="headerlink" href="#blocking-threads" title="Permalink to this headline">¶</a></h4>
<p>It is not recommended to schedule large tasks in the threadpool (like image
or sound processing) since it will block a thread and be unfair to other users.
Such tasks should be scheduled on separate threads (which should of course not
be created/destroyed each time there is work to do) synchronized with mutexes
and condition variables.</p>
<p>Additionally, an asynchronous task should not lock long-held mutexes or do
blocking calls. Every time a task does that, a thread of the threadpool is
blocked an no more work can be scheduled on it until the task finishes.</p>
</div>
</div>
<div class="section" id="threadpool-monitoring">
<h3>Threadpool Monitoring<a class="headerlink" href="#threadpool-monitoring" title="Permalink to this headline">¶</a></h3>
<p>The threadpool is constantly monitored by an external thread to check if it is
full (or deadlocked). The thread schedules a &#8220;ping&#8221; every 0.5 second and waits
for the &#8220;pong&#8221; for 0.5 second. If it times out, a new thread is spawned until
the maximum is reached. If 20 timeouts happen in a row, the emergency callback
is called (which may abort execution since a deadlock is likely to have
occurred).</p>
</div>
<div class="section" id="customizing-the-threadpool-behavior">
<h3>Customizing the Threadpool Behavior<a class="headerlink" href="#customizing-the-threadpool-behavior" title="Permalink to this headline">¶</a></h3>
<p>You can control how the threadpool behaves through environment variables.</p>
<ul class="simple">
<li><tt class="xref cpp cpp-guess docutils literal"><span class="pre">QI_EVENTLOOP_THREAD_COUNT</span></tt>: number of threads the eventloop should start
with. By default, it will start with one thread per CPU. This is overridden
by calling <a class="reference internal" href="#qi::startEventLoop__i" title="qi::startEventLoop"><tt class="xref cpp cpp-guess docutils literal"><span class="pre">qi::startEventLoop</span></tt></a> explicitly.</li>
<li><tt class="xref cpp cpp-guess docutils literal"><span class="pre">QI_EVENTLOOP_MAX_THREADS</span></tt>: maximum number of threads that the threadpool can
have.</li>
<li><tt class="xref cpp cpp-guess docutils literal"><span class="pre">QI_EVENTLOOP_GRACE_PERIOD</span></tt>: time in ms to wait after a failed ping, defaults
to 0.</li>
<li><tt class="xref cpp cpp-guess docutils literal"><span class="pre">QI_EVENTLOOP_PING_TIMEOUT</span></tt>: time in ms to wait for a ping response before
considering it failed, defaults to 500.</li>
<li><tt class="xref cpp cpp-guess docutils literal"><span class="pre">QI_EVENTLOOP_MAX_TIMEOUTS</span></tt>: number of timeouts before calling the emergency
callback, defaults to 20.</li>
</ul>
</div>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="qi-eventloop-class-reference">
<h3>qi::EventLoop Class Reference<a class="headerlink" href="#qi-eventloop-class-reference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<p>Class to handle eventloop.   .  <a class="reference external" href="#detailed-description"><tt class="docutils literal"><span class="pre">More...</span></tt></a></p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;qi/eventloop.hpp&gt;</span>
</pre></div>
</div>
<ul>
<li><strong>Inherits: </strong><tt class="docutils literal"><span class="pre">qi::ExecutionContext</span></tt></li>
</ul>
</div>
<div class="section" id="public-members">
<h4>Public Members<a class="headerlink" href="#public-members" title="Permalink to this headline">¶</a></h4>
<dl class="function function-index">
<dt>
<span>EventLoopPrivate*</span> <tt class="descname"><tt class="xref cpp cpp-func docutils literal"><span class="pre">_p</span></tt></tt></dt>
<dt>
<span>std::string</span> <tt class="descname"><tt class="xref cpp cpp-func docutils literal"><span class="pre">_name</span></tt></tt></dt>
</dl>

</div>
<div class="section" id="public-functions">
<h4>Public Functions<a class="headerlink" href="#public-functions" title="Permalink to this headline">¶</a></h4>
<dl class="function function-index">
<dt>
<span>Future&lt;R&gt;</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::async__boost::function:R:CR.uint64_t"><tt class="xref cpp cpp-func docutils literal"><span class="pre">async</span></tt></a></tt><big>(</big>const boost::function&lt;R()&gt;&amp; <em>callback</em>, uint64_t <em>usDelay</em><big>)</big></dt>
<dt>
<span>Future&lt;void&gt;</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::async__boost::function:void:CR.uint64_t"><tt class="xref cpp cpp-func docutils literal"><span class="pre">async</span></tt></a></tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, uint64_t <em>usDelay</em><big>)</big></dt>
<dt>
<span>Future&lt;void&gt;</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::async__boost::function:void:CR.qi::Duration"><tt class="xref cpp cpp-func docutils literal"><span class="pre">async</span></tt></a></tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, qi::Duration <em>delay</em><big>)</big></dt>
<dt>
<span>Future&lt;void&gt;</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::async__boost::function:void:CR.qi::SteadyClockTimePoint"><tt class="xref cpp cpp-func docutils literal"><span class="pre">async</span></tt></a></tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, qi::SteadyClockTimePoint <em>timepoint</em><big>)</big></dt>
<dt>
<span></span> <tt class="descname"><tt class="xref cpp cpp-func docutils literal"></tt></tt><big>(</big><big>)</big></dt>
<dt>
<span></span> <tt class="descname"><tt class="xref cpp cpp-func docutils literal"></tt></tt><big>(</big><big>)</big></dt>
<dt>
<span></span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::EventLoop__ssCR"><tt class="xref cpp cpp-func docutils literal"><span class="pre">EventLoop</span></tt></a></tt><big>(</big>const std::string&amp; <em>name</em><big>)</big></dt>
<dt>
<span></span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::~EventLoop"><tt class="xref cpp cpp-func docutils literal"><span class="pre">~EventLoop</span></tt></a></tt><big>(</big><big>)</big></dt>
<dt>
<span>bool</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::isInThisContext"><tt class="xref cpp cpp-func docutils literal"><span class="pre">isInThisContext</span></tt></a></tt><big>(</big><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::start__i"><tt class="xref cpp cpp-func docutils literal"><span class="pre">start</span></tt></a></tt><big>(</big>int <em>nthreads</em><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::join"><tt class="xref cpp cpp-func docutils literal"><span class="pre">join</span></tt></a></tt><big>(</big><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::stop"><tt class="xref cpp cpp-func docutils literal"><span class="pre">stop</span></tt></a></tt><big>(</big><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::setEmergencyCallback__boost::function:void:"><tt class="xref cpp cpp-func docutils literal"><span class="pre">setEmergencyCallback</span></tt></a></tt><big>(</big>boost::function&lt;void()&gt; <em>cb</em><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::setMaxThreads__unsigned-i"><tt class="xref cpp cpp-func docutils literal"><span class="pre">setMaxThreads</span></tt></a></tt><big>(</big>unsigned int <em>max</em><big>)</big></dt>
<dt>
<span>void*</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::nativeHandle"><tt class="xref cpp cpp-func docutils literal"><span class="pre">nativeHandle</span></tt></a></tt><big>(</big><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::post__boost::function:void:CR.uint64_t"><tt class="xref cpp cpp-func docutils literal"><span class="pre">post</span></tt></a></tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, uint64_t <em>usDelay</em><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::post__boost::function:void:CR.qi::Duration"><tt class="xref cpp cpp-func docutils literal"><span class="pre">post</span></tt></a></tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, qi::Duration <em>delay</em><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::post__boost::function:void:CR.qi::SteadyClockTimePoint"><tt class="xref cpp cpp-func docutils literal"><span class="pre">post</span></tt></a></tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, qi::SteadyClockTimePoint <em>timepoint</em><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::post__boost::function:void:CR"><tt class="xref cpp cpp-func docutils literal"><span class="pre">post</span></tt></a></tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em><big>)</big></dt>
<dt>
<span>Future&lt;void&gt;</span> <tt class="descname"><a class="reference external" href="#qi::EventLoop::monitorEventLoop__EventLoopP.uint64_t"><tt class="xref cpp cpp-func docutils literal"><span class="pre">monitorEventLoop</span></tt></a></tt><big>(</big>EventLoop* <em>helper</em>, uint64_t <em>maxUsDelay</em><big>)</big></dt>
</dl>

</div>
<div class="section" id="detailed-description">
<h4>Detailed Description<a class="headerlink" href="#detailed-description" title="Permalink to this headline">¶</a></h4>
<p>Class to handle eventloop.   .</p>
</div>
<div class="section" id="function-documentation">
<h4>Function Documentation<a class="headerlink" href="#function-documentation" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="qi::EventLoop::async__boost::function:R:CR.uint64_t">
Future&lt;R&gt; <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">async</tt><big>(</big>const boost::function&lt;R()&gt;&amp; <em>callback</em>, uint64_t <em>usDelay</em> = 0<big>)</big><a class="headerlink" href="#qi::EventLoop::async__boost::function:R:CR.uint64_t" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Call given function once after given delay in microseconds. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>callback</strong> &#8211; Callback to be called. </li>
<li><strong>usDelay</strong> &#8211; Delay before call the callback in microsecond. </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A canceleable future. </p>
</td>
</tr>
</tbody>
</table>
<p>Deprecateduse qi::async with qi::Duration</p>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::async__boost::function:void:CR.uint64_t">
Future&lt;void&gt; <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">async</tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, uint64_t <em>usDelay</em> = 0<big>)</big><a class="headerlink" href="#qi::EventLoop::async__boost::function:void:CR.uint64_t" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="qi::EventLoop::async__boost::function:void:CR.qi::Duration">
Future&lt;void&gt; <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">async</tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, <a class="reference external" href="clock.html#TPD_qi::Duration">qi::Duration</a> <em>delay</em><big>)</big><a class="headerlink" href="#qi::EventLoop::async__boost::function:void:CR.qi::Duration" title="Permalink to this definition">¶</a></dt>
<dd><p>call a callback asynchronously to be executed in delay</p>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::async__boost::function:void:CR.qi::SteadyClockTimePoint">
Future&lt;void&gt; <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">async</tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, qi::SteadyClockTimePoint <em>timepoint</em><big>)</big><a class="headerlink" href="#qi::EventLoop::async__boost::function:void:CR.qi::SteadyClockTimePoint" title="Permalink to this definition">¶</a></dt>
<dd><p>call a callback asynchronously to be executed on tp</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">()</tt></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<tt class="descname">()</tt></dt>
<dd></dd></dl>

<dl class="function">
<dt id="qi::EventLoop::EventLoop__ssCR">
 <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">EventLoop</tt><big>(</big>const std::string&amp; <em>name</em> = &quot;eventloop&quot;<big>)</big><a class="headerlink" href="#qi::EventLoop::EventLoop__ssCR" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Create a new eventLoop. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> &#8211; Name of the event loop created.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>You must then call either start(), run() or startThreadPool() to start event processing.</p>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::~EventLoop">
 <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">~EventLoop</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::EventLoop::~EventLoop" title="Permalink to this definition">¶</a></dt>
<dd><p>Default destructor.</p>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::isInThisContext">
bool <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">isInThisContext</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::EventLoop::isInThisContext" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Check if current thread is the event loop thread. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">true if current thread is the event loop thread. </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::start__i">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">start</tt><big>(</big>int <em>nthreads</em> = 0<big>)</big><a class="headerlink" href="#qi::EventLoop::start__i" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Start the eventloop in threaded mode. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>nthreads</strong> &#8211; Numbers of threads. </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::join">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">join</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::EventLoop::join" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for run thread to terminate.</p>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::stop">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">stop</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::EventLoop::stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Ask main loop to terminate.</p>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::setEmergencyCallback__boost::function:void:">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">setEmergencyCallback</tt><big>(</big>boost::function&lt;void()&gt; <em>cb</em><big>)</big><a class="headerlink" href="#qi::EventLoop::setEmergencyCallback__boost::function:void:" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Set callback to be called in case of a deadlock detection. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>cb</strong> &#8211; Callback to be called. </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::setMaxThreads__unsigned-i">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">setMaxThreads</tt><big>(</big>unsigned int <em>max</em><big>)</big><a class="headerlink" href="#qi::EventLoop::setMaxThreads__unsigned-i" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Set the maximum number of threads in the pool. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>max</strong> &#8211; Maximum number of threads. </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::nativeHandle">
void* <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">nativeHandle</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::EventLoop::nativeHandle" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal function.</p>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::post__boost::function:void:CR.uint64_t">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">post</tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, uint64_t <em>usDelay</em><big>)</big><a class="headerlink" href="#qi::EventLoop::post__boost::function:void:CR.uint64_t" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Similar to async() but without cancelation or notification. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>callback</strong> &#8211; Callback to be called. </li>
<li><strong>usDelay</strong> &#8211; Delay before call the callback in microsecond. </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::post__boost::function:void:CR.qi::Duration">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">post</tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, <a class="reference external" href="clock.html#TPD_qi::Duration">qi::Duration</a> <em>delay</em><big>)</big><a class="headerlink" href="#qi::EventLoop::post__boost::function:void:CR.qi::Duration" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="qi::EventLoop::post__boost::function:void:CR.qi::SteadyClockTimePoint">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">post</tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em>, qi::SteadyClockTimePoint <em>timepoint</em><big>)</big><a class="headerlink" href="#qi::EventLoop::post__boost::function:void:CR.qi::SteadyClockTimePoint" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="qi::EventLoop::post__boost::function:void:CR">
void <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">post</tt><big>(</big>const boost::function&lt;void()&gt;&amp; <em>callback</em><big>)</big><a class="headerlink" href="#qi::EventLoop::post__boost::function:void:CR" title="Permalink to this definition">¶</a></dt>
<dd><p>post a callback to be executed as soon as possible</p>
</dd></dl>

<dl class="function">
<dt id="qi::EventLoop::monitorEventLoop__EventLoopP.uint64_t">
Future&lt;void&gt; <tt class="descclassname">qi::EventLoop::</tt><tt class="descname">monitorEventLoop</tt><big>(</big>EventLoop* <em>helper</em>, uint64_t <em>maxUsDelay</em><big>)</big><a class="headerlink" href="#qi::EventLoop::monitorEventLoop__EventLoopP.uint64_t" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Monitor event loop to detect deadlocks. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>helper</strong> &#8211; an other event loop used for monitoring. </li>
<li><strong>maxUsDelay</strong> &#8211; maximum expected delay between an async() and its execution. </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A canceleable future. Invoke cancel() to terminate monitoring. In case an async() call does not execute in time, the future&#8217;s error will be set. </p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<dl class="function">
<dt id="qi::getEventLoop">
EventLoop* <tt class="descclassname">qi::</tt><tt class="descname">getEventLoop</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::getEventLoop" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the global eventloop, created on demand on first call.</p>
</dd></dl>

<dl class="function">
<dt id="qi::startEventLoop__i">
void <tt class="descclassname">qi::</tt><tt class="descname">startEventLoop</tt><big>(</big>int <em>nthread</em><big>)</big><a class="headerlink" href="#qi::startEventLoop__i" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Start the eventloop with nthread threads. No-op if already started. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>nthread</strong> &#8211; Set the minimum number of worker threads in the pool. </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::getIoService">
boost::asio::io_service&amp; <tt class="descclassname">qi::</tt><tt class="descname">getIoService</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::getIoService" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em>Get the io_service used by the global event loop. </p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">io_service used by the global event loop. </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::async__boost::function:R:.uint64_t">
Future&lt;R&gt; <tt class="descclassname">qi::</tt><tt class="descname">async</tt><big>(</big>boost::function&lt;R()&gt; <em>callback</em>, uint64_t <em>usDelay</em> = 0<big>)</big><a class="headerlink" href="#qi::async__boost::function:R:.uint64_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Call given function once after given delay in microseconds.</p>
<p>callback</p>
<p>Callback to be called.</p>
<p>usDelay</p>
<p>Delay before call the callback in microsecond.</p>
<p>A canceleable future. 
Deprecateduse qi::async with qi::Duration 
. Deprecateduse qi::async with qi::Duration</p>
</dd></dl>

<dl class="function">
<dt id="qi::async__boost::function:R:.qi::Duration">
Future&lt;R&gt; <tt class="descclassname">qi::</tt><tt class="descname">async</tt><big>(</big>boost::function&lt;R()&gt; <em>callback</em>, <a class="reference external" href="clock.html#TPD_qi::Duration">qi::Duration</a> <em>delay</em><big>)</big><a class="headerlink" href="#qi::async__boost::function:R:.qi::Duration" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="qi::async__boost::function:R:.qi::SteadyClockTimePoint">
Future&lt;R&gt; <tt class="descclassname">qi::</tt><tt class="descname">async</tt><big>(</big>boost::function&lt;R()&gt; <em>callback</em>, qi::SteadyClockTimePoint <em>timepoint</em><big>)</big><a class="headerlink" href="#qi::async__boost::function:R:.qi::SteadyClockTimePoint" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>


          </div>
          <div class="footernav">
    &laquo; <a href="dynamicobjectbuilder.html" title="qi::DynamicObjectBuilder">qi::DynamicObjectBuilder</a>
     |
    <a href="index.html" title="C++ qi API Reference" accesskey="U">C++ qi API Reference</a>
   |
    <a href="future.html" title="qi::Promise, qi::Future">qi::Promise, qi::Future</a> &raquo;</div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>


  <h3>Table Of Contents</h3>
  <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API References</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">C++ qi API Reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="actor.html">qi::Actor and qi::Strand</a></li>
<li class="toctree-l3"><a class="reference internal" href="application.html">qi::Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="applicationsession.html">qi::ApplicationSession</a></li>
<li class="toctree-l3"><a class="reference internal" href="anyvalue.html">qi::AnyValue</a></li>
<li class="toctree-l3"><a class="reference internal" href="anyfunction.html">qi::AnyFunction</a></li>
<li class="toctree-l3"><a class="reference internal" href="anyobject.html">qi::Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="anymodule.html">qi::AnyModule</a></li>
<li class="toctree-l3"><a class="reference internal" href="atomic.html">qi::Atomic</a></li>
<li class="toctree-l3"><a class="reference internal" href="buffer.html">qi::Buffer, qi::BufferReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="binarycodec.html">Binary Codec</a></li>
<li class="toctree-l3"><a class="reference internal" href="clock.html">qi::Clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamicobjectbuilder.html">qi::DynamicObjectBuilder</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">qi::EventLoop</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="future.html">qi::Promise, qi::Future</a></li>
<li class="toctree-l3"><a class="reference internal" href="iocolor.html">qi::IOColor</a></li>
<li class="toctree-l3"><a class="reference internal" href="jsoncodec.html">JSON Codec</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">qi::log</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro.html">qi helper macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="metaobject.html">qi::MetaObject, qi::MetaMethod, qi::MetaSignal, qi::MetaProperty</a></li>
<li class="toctree-l3"><a class="reference internal" href="objecttypebuilder.html">qi::ObjectTypeBuilder</a></li>
<li class="toctree-l3"><a class="reference internal" href="os.html">qi::os</a></li>
<li class="toctree-l3"><a class="reference internal" href="path.html">qi::path namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="periodictask.html">qi::PeriodicTask</a></li>
<li class="toctree-l3"><a class="reference internal" href="preproc.html">qi preprocessor macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="property.html">qi::Property</a></li>
<li class="toctree-l3"><a class="reference internal" href="session.html">qi::Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="signal.html">qi::Signal</a></li>
<li class="toctree-l3"><a class="reference internal" href="signature.html">qi::Signature</a></li>
<li class="toctree-l3"><a class="reference internal" href="stats.html">qi::stats namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="trackable.html">qi::Trackable</a></li>
<li class="toctree-l3"><a class="reference internal" href="translator.html">qi::Translator</a></li>
<li class="toctree-l3"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="url.html">qi::Url</a></li>
<li class="toctree-l3"><a class="reference internal" href="version.html">qi::Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cpp-classindex.html">C++ Class Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cpp-funcindex.html">C++ Function Index</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../python/index.html">Python qi API reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/index.html">User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/index.html">Design Documents</a></li>
</ul>

    <h3><a href="../../index.html">On this page</a></h3>
    <ul>
<li><a class="reference internal" href="#">qi::EventLoop</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#detailed-description">Detailed Description</a><ul>
<li><a class="reference internal" href="#good-use-of-a-threadpool">Good use of a threadpool</a><ul>
<li><a class="reference internal" href="#blocking-threads">Blocking threads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#threadpool-monitoring">Threadpool Monitoring</a></li>
<li><a class="reference internal" href="#customizing-the-threadpool-behavior">Customizing the Threadpool Behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference">Reference</a><ul>
<li><a class="reference internal" href="#qi-eventloop-class-reference">qi::EventLoop Class Reference</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#public-members">Public Members</a></li>
<li><a class="reference internal" href="#public-functions">Public Functions</a></li>
<li><a class="reference internal" href="#detailed-description">Detailed Description</a></li>
<li><a class="reference internal" href="#function-documentation">Function Documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="dynamicobjectbuilder.html" title="qi::DynamicObjectBuilder">previous</a>
     |
    <a href="index.html" title="C++ qi API Reference" accesskey="U">up</a>
   |
    <a href="future.html" title="qi::Promise, qi::Future">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>