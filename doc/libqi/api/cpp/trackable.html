
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>qi::Trackable &mdash; qi SDK Documentation 2.2.0.55 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.0.55',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="qi SDK Documentation 2.2.0.55 documentation" href="../../index.html" />
    <link rel="up" title="C++ qi API Reference" href="index.html" />
    <link rel="next" title="qi::Translator" href="translator.html" />
    <link rel="prev" title="qi::stats namespace" href="stats.html" />
 
<script>
$(window).ready(function () {
    var width_label = 0;
    $('dl.function-index dt > span').each(function () {
        $(this).css('width', 'auto');
        width_label = Math.max(width_label, $(this).width());
    }).width(width_label + 30);
    $('.sig-paren').width('auto');
})

</script>


<script type="text/javascript" src="/static/js/ga-status.js"></script>



  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      <h1><a href="../../index.html">qi SDK Documentation 2.2.0.55 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>
         |
        <a title="Site map" href="../../contents.html">Site map</a>
         |
        <a title="Search" href="../../search.html">Search</a>
         |
        <a title="Index" href="../../genindex.html">Index</a>
      </div>
      <div class="nav">
    &laquo; <a href="stats.html" title="qi::stats namespace">previous</a>
     |
    <a href="index.html" title="C++ qi API Reference" accesskey="U">up</a>
   |
    <a href="translator.html" title="qi::Translator">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="api-cpp-trackable">
            
  <div class="section" id="qi-trackable">
<h1>qi::Trackable<a class="headerlink" href="#qi-trackable" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<strong><p class="rubric">Global Namespaces</p>
</strong><ul>
<li><p class="first">namespace qi</p>
<dl class="docutils">
<strong><p class="rubric">Classes (namespace qi)</p>
</strong><ul>
<li><p class="first">class qi::Trackable</p>
<dl class="docutils">
</dl>
</li>
</ul>
<strong><p class="rubric">Functions (namespace qi)</p>
</strong><ul class="simple">
<a class="reference internal" href="#qi::bind__AFCR.X">qi::bind</a></ul>
</dl>
</li>
<li><p class="first">namespace qi::Trackable&lt;T&gt;</p>
<dl class="docutils">
<strong><p class="rubric">Functions (namespace qi::Trackable&lt;T&gt;)</p>
</strong><ul class="simple">
<a class="reference internal" href="#qi::Trackable:T:::lock">qi::Trackable&lt;T&gt;::lock</a><p><a class="reference internal" href="#qi::Trackable:T:::weakPtr">qi::Trackable&lt;T&gt;::weakPtr</a></p>
<p><a class="reference internal" href="#qi::Trackable:T:::wait">qi::Trackable&lt;T&gt;::wait</a></p>
<p><a class="reference internal" href="#qi::Trackable:T:::Trackable__TP">qi::Trackable&lt;T&gt;::Trackable</a></p>
<p><a class="reference internal" href="#qi::Trackable:T:::~Trackable">qi::Trackable&lt;T&gt;::~Trackable</a></p>
</ul>
</dl>
</li>
</ul>
</dl>
</div>
<div class="section" id="detailed-description">
<h2>Detailed Description<a class="headerlink" href="#detailed-description" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rationale">
<h3>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="n">callback</span><span class="p">();</span>
<span class="p">};</span>

<span class="n">qi</span><span class="o">::</span><span class="n">Signal</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">signal</span><span class="p">;</span>

<span class="n">MyClass</span><span class="o">*</span> <span class="n">my</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="p">();</span>
<span class="n">signal</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MyClass</span><span class="o">::</span><span class="n">callback</span><span class="p">,</span> <span class="n">my</span><span class="p">);</span>
<span class="k">delete</span> <span class="n">my</span><span class="p">;</span>

<span class="n">signal</span><span class="p">();</span> <span class="c1">// CRASH</span>
</pre></div>
</div>
<p>In this code, the program will probably crash because the callback will be
called even though <tt class="xref cpp cpp-guess docutils literal"><span class="pre">my</span></tt> has been destroyed.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>In this case, you need to use <a class="reference internal" href="#qi::Trackable" title="qi::Trackable"><tt class="xref cpp cpp-guess docutils literal"><span class="pre">qi::Trackable</span></tt></a> with <a class="reference internal" href="#qi::bind__AFCR.X" title="qi::bind"><tt class="xref cpp cpp-guess docutils literal"><span class="pre">qi::bind</span></tt></a> so that the
callback won&#8217;t be called when your object dies. Note that you usually don&#8217;t
need to call <a class="reference internal" href="#qi::bind__AFCR.X" title="qi::bind"><tt class="xref cpp cpp-guess docutils literal"><span class="pre">qi::bind</span></tt></a> explicitely, <a class="reference internal" href="future.html#qi::Future:T:::connect__AFCR.FutureCallbackType" title="qi::Future&lt;T&gt;::connect"><tt class="xref cpp cpp-guess docutils literal"><span class="pre">qi::Future::connect</span></tt></a> and
<tt class="xref cpp cpp-guess docutils literal"><span class="pre">qi::Signal::connect</span></tt> do it for you.</p>
<p>MyClass should inherit from <tt class="xref cpp cpp-guess docutils literal"><span class="pre">qi::Trackable</span></tt> and the constructor must
call <a class="reference internal" href="#qi::Trackable" title="qi::Trackable"><tt class="xref cpp cpp-guess docutils literal"><span class="pre">qi::Trackable</span></tt></a>&#8216;s constructor with <tt class="docutils literal"><span class="pre">this</span></tt>. Then, you <em>must</em> call
<tt class="xref cpp cpp-guess docutils literal"><span class="pre">destroy()</span></tt> at the <em>beginning</em> of your destructor. <tt class="xref cpp cpp-guess docutils literal"><span class="pre">destroy()</span></tt> ensures that all
callbacks are finished before you start destructing your object. You must <em>not</em>
use <tt class="docutils literal"><span class="pre">boost::bind</span></tt> if you want your object to be tracked!</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;qi/trackable.hpp&gt;</span>

<span class="k">class</span> <span class="nc">MyClass</span> <span class="o">:</span> <span class="n">qi</span><span class="o">::</span><span class="n">Trackable</span><span class="o">&lt;</span><span class="n">MyClass</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="n">MyClass</span><span class="p">()</span> <span class="o">:</span> <span class="n">qi</span><span class="o">::</span><span class="n">Trackable</span><span class="o">&lt;</span><span class="n">MyClass</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">{}</span>
  <span class="o">~</span><span class="n">MyClass</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">destroy</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">callback</span><span class="p">();</span>
<span class="p">};</span>

<span class="n">qi</span><span class="o">::</span><span class="n">Signal</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">signal</span><span class="p">;</span>

<span class="n">MyClass</span><span class="o">*</span> <span class="n">my</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="p">();</span>
<span class="n">signal</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MyClass</span><span class="o">::</span><span class="n">callback</span><span class="p">,</span> <span class="n">my</span><span class="p">);</span>
<span class="k">delete</span> <span class="n">my</span><span class="p">;</span>

<span class="n">signal</span><span class="p">();</span> <span class="c1">// callback won&#39;t be called, no crash</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="qi-trackable-class-reference">
<h3>qi::Trackable Class Reference<a class="headerlink" href="#qi-trackable-class-reference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<p>Object tracking by blocking destruction while shared pointers are present.  <a class="reference external" href="#detailed-description"><tt class="docutils literal"><span class="pre">More...</span></tt></a></p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;qi/trackable.hpp&gt;</span>
</pre></div>
</div>
<ul>
<li><strong>Inherits: </strong><tt class="docutils literal"><span class="pre">qi::TrackableBase</span></tt></li>
</ul>
</div>
<div class="section" id="public-functions">
<h4>Public Functions<a class="headerlink" href="#public-functions" title="Permalink to this headline">¶</a></h4>
<dl class="function function-index">
<dt>
<span></span> <tt class="descname"><a class="reference external" href="#qi::Trackable:T:::Trackable__TP"><tt class="xref cpp cpp-func docutils literal"><span class="pre">Trackable</span></tt></a></tt><big>(</big>T* <em>ptr</em><big>)</big></dt>
<dt>
<span></span> <tt class="descname"><a class="reference external" href="#qi::Trackable:T:::~Trackable"><tt class="xref cpp cpp-func docutils literal"><span class="pre">~Trackable</span></tt></a></tt><big>(</big><big>)</big></dt>
<dt>
<span>boost::shared_ptr&lt;T&gt;</span> <tt class="descname"><a class="reference external" href="#qi::Trackable:T:::lock"><tt class="xref cpp cpp-func docutils literal"><span class="pre">lock</span></tt></a></tt><big>(</big><big>)</big></dt>
<dt>
<span>boost::weak_ptr&lt;T&gt;</span> <tt class="descname"><a class="reference external" href="#qi::Trackable:T:::weakPtr"><tt class="xref cpp cpp-func docutils literal"><span class="pre">weakPtr</span></tt></a></tt><big>(</big><big>)</big></dt>
<dt>
<span>void</span> <tt class="descname"><a class="reference external" href="#qi::Trackable:T:::wait"><tt class="xref cpp cpp-func docutils literal"><span class="pre">wait</span></tt></a></tt><big>(</big><big>)</big></dt>
</dl>

</div>
<div class="section" id="detailed-description">
<h4>Detailed Description<a class="headerlink" href="#detailed-description" title="Permalink to this headline">¶</a></h4>
<p><p>Inherit from Trackable to allow a form of tracking that blocks destruction while shared pointers are held. This allows using your class without a shared_ptr wrapper.</p>
<p>when inheriting from this class, you <em>must</em> invoke the destroy() method from your destructor, before any operation that puts your object in an invalid state.since destroy() blocks until all shared pointers are destroyed, deadlocks may occur if used improperly.</p>
</p>
</div>
<div class="section" id="function-documentation">
<h4>Function Documentation<a class="headerlink" href="#function-documentation" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="qi::Trackable:T:::Trackable__TP">
 <tt class="descclassname">qi::Trackable&lt;T&gt;::</tt><tt class="descname">Trackable</tt><big>(</big>T* <em>ptr</em><big>)</big><a class="headerlink" href="#qi::Trackable:T:::Trackable__TP" title="Permalink to this definition">¶</a></dt>
<dd><p>Default constructor.</p>
</dd></dl>

<dl class="function">
<dt id="qi::Trackable:T:::~Trackable">
 <tt class="descclassname">qi::Trackable&lt;T&gt;::</tt><tt class="descname">~Trackable</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::Trackable:T:::~Trackable" title="Permalink to this definition">¶</a></dt>
<dd><p>Default destructor.</p>
</dd></dl>

<dl class="function">
<dt id="qi::Trackable:T:::lock">
boost::shared_ptr&lt;T&gt; <tt class="descclassname">qi::Trackable&lt;T&gt;::</tt><tt class="descname">lock</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::Trackable:T:::lock" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A shared_ptr that will block destruction (call to destroy() until it is released, or an empty shared_ptr if destroy was already called. </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::Trackable:T:::weakPtr">
boost::weak_ptr&lt;T&gt; <tt class="descclassname">qi::Trackable&lt;T&gt;::</tt><tt class="descname">weakPtr</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::Trackable:T:::weakPtr" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Brief: </em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A weak_ptr from this. While a shared_ptr exists from this weak_ptr, a call to destroy will block() </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="qi::Trackable:T:::wait">
void <tt class="descclassname">qi::Trackable&lt;T&gt;::</tt><tt class="descname">wait</tt><big>(</big><big>)</big><a class="headerlink" href="#qi::Trackable:T:::wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Blocks until destroy() is called and all shared_ptr built from weak_ptr() are deleted.</p>
</dd></dl>

</div>
</div>
<dl class="function">
<dt id="qi::bind__AFCR.X">
boost::function&lt;RF&gt; <tt class="descclassname">qi::</tt><tt class="descname">bind</tt><big>(</big>const AF&amp; <em>fun</em>, <em>...</em><big>)</big><a class="headerlink" href="#qi::bind__AFCR.X" title="Permalink to this definition">¶</a></dt>
<dd><p>Bind a set of arguments or placeholders to a function.</p>
<p>Handles first function argument of kind boost::weak_ptr and qi::Trackable: will try to lock and throw qi::PointerLockException in case of failure</p>
</dd></dl>

</div>
</div>


          </div>
          <div class="footernav">
    &laquo; <a href="stats.html" title="qi::stats namespace">qi::stats namespace</a>
     |
    <a href="index.html" title="C++ qi API Reference" accesskey="U">C++ qi API Reference</a>
   |
    <a href="translator.html" title="qi::Translator">qi::Translator</a> &raquo;</div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>


  <h3>Table Of Contents</h3>
  <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API References</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">C++ qi API Reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="actor.html">qi::Actor and qi::Strand</a></li>
<li class="toctree-l3"><a class="reference internal" href="application.html">qi::Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="applicationsession.html">qi::ApplicationSession</a></li>
<li class="toctree-l3"><a class="reference internal" href="anyvalue.html">qi::AnyValue</a></li>
<li class="toctree-l3"><a class="reference internal" href="anyfunction.html">qi::AnyFunction</a></li>
<li class="toctree-l3"><a class="reference internal" href="anyobject.html">qi::Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="anymodule.html">qi::AnyModule</a></li>
<li class="toctree-l3"><a class="reference internal" href="atomic.html">qi::Atomic</a></li>
<li class="toctree-l3"><a class="reference internal" href="buffer.html">qi::Buffer, qi::BufferReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="binarycodec.html">Binary Codec</a></li>
<li class="toctree-l3"><a class="reference internal" href="clock.html">qi::Clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamicobjectbuilder.html">qi::DynamicObjectBuilder</a></li>
<li class="toctree-l3"><a class="reference internal" href="eventloop.html">qi::EventLoop</a></li>
<li class="toctree-l3"><a class="reference internal" href="future.html">qi::Promise, qi::Future</a></li>
<li class="toctree-l3"><a class="reference internal" href="iocolor.html">qi::IOColor</a></li>
<li class="toctree-l3"><a class="reference internal" href="jsoncodec.html">JSON Codec</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">qi::log</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro.html">qi helper macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="metaobject.html">qi::MetaObject, qi::MetaMethod, qi::MetaSignal, qi::MetaProperty</a></li>
<li class="toctree-l3"><a class="reference internal" href="objecttypebuilder.html">qi::ObjectTypeBuilder</a></li>
<li class="toctree-l3"><a class="reference internal" href="os.html">qi::os</a></li>
<li class="toctree-l3"><a class="reference internal" href="path.html">qi::path namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="periodictask.html">qi::PeriodicTask</a></li>
<li class="toctree-l3"><a class="reference internal" href="preproc.html">qi preprocessor macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="property.html">qi::Property</a></li>
<li class="toctree-l3"><a class="reference internal" href="session.html">qi::Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="signal.html">qi::Signal</a></li>
<li class="toctree-l3"><a class="reference internal" href="signature.html">qi::Signature</a></li>
<li class="toctree-l3"><a class="reference internal" href="stats.html">qi::stats namespace</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">qi::Trackable</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="translator.html">qi::Translator</a></li>
<li class="toctree-l3"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="url.html">qi::Url</a></li>
<li class="toctree-l3"><a class="reference internal" href="version.html">qi::Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cpp-classindex.html">C++ Class Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cpp-funcindex.html">C++ Function Index</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../python/index.html">Python qi API reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/index.html">User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/index.html">Design Documents</a></li>
</ul>

    <h3><a href="../../index.html">On this page</a></h3>
    <ul>
<li><a class="reference internal" href="#">qi::Trackable</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#detailed-description">Detailed Description</a><ul>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference">Reference</a><ul>
<li><a class="reference internal" href="#qi-trackable-class-reference">qi::Trackable Class Reference</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#public-functions">Public Functions</a></li>
<li><a class="reference internal" href="#detailed-description">Detailed Description</a></li>
<li><a class="reference internal" href="#function-documentation">Function Documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="stats.html" title="qi::stats namespace">previous</a>
     |
    <a href="index.html" title="C++ qi API Reference" accesskey="U">up</a>
   |
    <a href="translator.html" title="qi::Translator">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>