
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How to write a qimessaging service in C++ &mdash; qi SDK Documentation 2.2.0.55 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.2.0.55',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="qi SDK Documentation 2.2.0.55 documentation" href="../index.html" />
    <link rel="up" title="User Guides" href="index.html" />
    <link rel="next" title="Registering types in the type system" href="cxx-register-types.html" />
    <link rel="prev" title="How to write a qimessaging client in C++" href="cxx-client.html" />
 
<script>
$(window).ready(function () {
    var width_label = 0;
    $('dl.function-index dt > span').each(function () {
        $(this).css('width', 'auto');
        width_label = Math.max(width_label, $(this).width());
    }).width(width_label + 30);
    $('.sig-paren').width('auto');
})

</script>


<script type="text/javascript" src="/static/js/ga-status.js"></script>



  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      <h1><a href="../index.html">qi SDK Documentation 2.2.0.55 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>
         |
        <a title="Site map" href="../contents.html">Site map</a>
         |
        <a title="Search" href="../search.html">Search</a>
         |
        <a title="Index" href="../genindex.html">Index</a>
      </div>
      <div class="nav">
    &laquo; <a href="cxx-client.html" title="How to write a qimessaging client in C++">previous</a>
     |
    <a href="index.html" title="User Guides" accesskey="U">up</a>
   |
    <a href="cxx-register-types.html" title="Registering types in the type system">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="guide-cxx-service">
            
  <div class="section" id="how-to-write-a-qimessaging-service-in-c">
<span id="guide-cxx-service"></span><h1>How to write a qimessaging service in C++<a class="headerlink" href="#how-to-write-a-qimessaging-service-in-c" title="Permalink to this headline">¶</a></h1>
<p>This document will teach you how to write your very own qimessaging service,
so that your new shiny object can be used by other qimessaging services and
clients, locally or remotely, and from many different programming languages.</p>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>There are some restrictions on what you can do:</p>
<ul class="simple">
<li>Do not use <em>class member data</em>.</li>
<li>Output parameters are not supported: you should not take pointers as arguments,
or non-const references.</li>
<li>Do not use methods in transmitted <em>struct</em>, as they will not be available in
other languages: put the methods in an associated <em>class</em>.</li>
</ul>
<p>To understand those restrictions, keep in mind that qimessaging is a middleware
that knows how to transport <em>data</em> (like primitive types, structs, and containers
of the above), and how to make calls to remote methods, signals and properties,
but cannot mix the two.</p>
</div>
<div class="section" id="write-your-service">
<h2>Write your service<a class="headerlink" href="#write-your-service" title="Permalink to this headline">¶</a></h2>
<p>Your service can be a simple class which is registered in the type system (see
<a class="reference internal" href="cxx-register-types.html#guide-cxx-register-types"><em>type registration</em></a></p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;qi/anyobject.hpp&gt;</span>

<span class="k">struct</span> <span class="n">Mosquito</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">yaw</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">QI_TYPE_STRUCT</span><span class="p">(</span><span class="n">Mosquito</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Cat</span>
<span class="p">{</span>
  <span class="nl">public:</span>
    <span class="kt">void</span> <span class="n">meow</span><span class="p">(</span><span class="kt">int</span> <span class="n">volume</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="nf">setTarget</span><span class="p">(</span><span class="k">const</span> <span class="n">Mosquito</span><span class="o">&amp;</span> <span class="n">m</span><span class="p">);</span>

    <span class="n">qi</span><span class="o">::</span><span class="n">Property</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">hunger</span><span class="p">;</span>
    <span class="n">qi</span><span class="o">::</span><span class="n">Property</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">boredom</span><span class="p">;</span>
    <span class="n">qi</span><span class="o">::</span><span class="n">Property</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">cuteness</span><span class="p">;</span>
    <span class="n">qi</span><span class="o">::</span><span class="n">Signal</span><span class="o">&lt;</span><span class="n">Mosquito</span><span class="o">&gt;</span> <span class="n">onTargetDetected</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">QI_REGISTER_OBJECT</span><span class="p">(</span><span class="n">Cat</span><span class="p">,</span> <span class="n">meow</span><span class="p">,</span> <span class="n">setTarget</span><span class="p">,</span> <span class="n">hunger</span><span class="p">,</span> <span class="n">boredom</span><span class="p">,</span> <span class="n">cuteness</span><span class="p">,</span>
    <span class="n">onTargetDetected</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="sessions-and-servicedirectory">
<h2>Sessions and ServiceDirectory<a class="headerlink" href="#sessions-and-servicedirectory" title="Permalink to this headline">¶</a></h2>
<p>Sessions may be listening and/or connected to other sessions. In a group of
sessions, one and only one ServiceDirectory must be registered which will keep
track of all registered services. Usually, one session is used as a server with
<tt class="xref cpp cpp-guess docutils literal"><span class="pre">listenStandalone()</span></tt> and other sessions are used as client with <tt class="xref cpp cpp-guess docutils literal"><span class="pre">connect()</span></tt>.</p>
<p><tt class="xref cpp cpp-guess docutils literal"><span class="pre">listenStandalone()</span></tt> is the same function as <tt class="xref cpp cpp-guess docutils literal"><span class="pre">listen()</span></tt> but it will also
register a ServiceDirectory on the session.</p>
</div>
<div class="section" id="registering-your-service-on-a-servicedirectory">
<h2>Registering your service on a ServiceDirectory<a class="headerlink" href="#registering-your-service-on-a-servicedirectory" title="Permalink to this headline">¶</a></h2>
<p>You can then instantiate your object and expose it on a session. It does not
matter whether your session is a listener or a client. As the client session is
already shown in the <a class="reference internal" href="cxx-client.html#guide-cxx-client"><em>client session guide</em></a>, we will do
the listener example here.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;qi/application.hpp&gt;</span>
<span class="cp">#include &lt;qi/session.hpp&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">qi</span><span class="o">::</span><span class="n">Application</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

  <span class="n">qi</span><span class="o">::</span><span class="n">SessionPtr</span> <span class="n">session</span> <span class="o">=</span> <span class="n">qi</span><span class="o">::</span><span class="n">makeSession</span><span class="p">();</span>
  <span class="n">session</span><span class="o">-&gt;</span><span class="n">listenStandalone</span><span class="p">(</span><span class="s">&quot;tcp://localhost:9559&quot;</span><span class="p">);</span>

  <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Cat</span><span class="o">&gt;</span> <span class="n">cat</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Cat</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">session</span><span class="o">-&gt;</span><span class="n">registerService</span><span class="p">(</span><span class="s">&quot;CatService&quot;</span><span class="p">,</span> <span class="n">cat</span><span class="p">);</span>

  <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The session will keep a reference on cat until it&#8217;s closed.</p>
</div>
</div>


          </div>
          <div class="footernav">
    &laquo; <a href="cxx-client.html" title="How to write a qimessaging client in C++">How to write a qimessaging client in C++</a>
     |
    <a href="index.html" title="User Guides" accesskey="U">User Guides</a>
   |
    <a href="cxx-register-types.html" title="Registering types in the type system">Registering types in the type system</a> &raquo;</div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>


  <h3>Table Of Contents</h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API References</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cxx-client.html">How to write a qimessaging client in C++</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">How to write a qimessaging service in C++</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cxx-register-types.html">Registering types in the type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxx-async.html">Asynchronous operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxx-log.html">Using qi::log</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxx-linguist.html">Internationalization Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxx-path.html">Handling Paths Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxx-path.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxx-path.html#using-namespace-path">Using Namespace path</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxx-path.html#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="py-client.html">How to write a qimessaging client in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="py-service.html">How to write a qimessaging service in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="py-tonaoqi2.html">How to switch from NAOqi1 to NAOqi2</a></li>
<li class="toctree-l2"><a class="reference internal" href="py-log-client.html">How to receive and send logs in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="qi-package-services.html">Packaging services in an application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design Documents</a></li>
</ul>

    <h3><a href="../index.html">On this page</a></h3>
    <ul>
<li><a class="reference internal" href="#">How to write a qimessaging service in C++</a><ul>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
<li><a class="reference internal" href="#write-your-service">Write your service</a></li>
<li><a class="reference internal" href="#sessions-and-servicedirectory">Sessions and ServiceDirectory</a></li>
<li><a class="reference internal" href="#registering-your-service-on-a-servicedirectory">Registering your service on a ServiceDirectory</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="cxx-client.html" title="How to write a qimessaging client in C++">previous</a>
     |
    <a href="index.html" title="User Guides" accesskey="U">up</a>
   |
    <a href="cxx-register-types.html" title="Registering types in the type system">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>